{"id":"ISSUE-001","uuid":"6a41fb64-d043-415d-911d-76f2536795f4","title":"Server: Project Initialization & Basic Express Setup","content":"Set up the basic TypeScript + Express project structure for the sudocode backend server.\n\n## Tasks\n- [ ] Create `server/` directory structure\n- [ ] Initialize `package.json` with dependencies (express, typescript, etc.)\n- [ ] Create `tsconfig.json` for TypeScript configuration\n- [ ] Set up basic Express app in `src/index.ts`\n- [ ] Add development scripts (dev, build, start)\n- [ ] Create `.env.example` for environment variables\n- [ ] Create `.gitignore` with appropriate entries\n\n## Files to Create\n```\nserver/\n├── src/\n│   └── index.ts          # Basic Express app\n├── package.json\n├── tsconfig.json\n├── .env.example\n└── .gitignore\n```\n\n## Verification\n- Server should start on http://localhost:3001\n- GET http://localhost:3001/health should return 200\n- `npm run dev` should start the server successfully\n\n## Success Criteria\nExpress server that starts successfully with a health check endpoint.\n\nReference: [[server/server_plan.md]] - Phase 1, Step 1.1","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.036Z","created_at":"2025-10-24 09:53:37","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-28 19:03:00","parent_id":null,"relationships":[],"tags":["foundation","phase-1","server","setup"]}
{"id":"ISSUE-002","uuid":"326b22be-f823-4cf9-a281-c774cb6742cc","title":"Server: Database Setup & Schema Implementation","content":"Initialize SQLite database with schema for sudocode server.\n\n## Tasks\n- [ ] Create `src/services/db.ts` with database connection\n- [ ] Import schema from `../cli/src/schema.ts`\n- [ ] Add new tables for projects, issue_attempts, execution_processes\n- [ ] Add execution_process_logs table\n- [ ] Write database initialization function\n- [ ] Add database migration logic\n- [ ] Create helper functions for common queries\n\n## Files to Create\n```\nserver/src/\n├── services/\n│   └── db.ts             # Database connection & init\n└── types/\n    └── extended.ts       # Extended types (Project, IssueAttempt, etc.)\n```\n\n## Schema Additions\n- Projects table\n- Issue attempts table\n- Execution processes table\n- Execution process logs table\n\n## Verification\n- Run server with `npm run dev`\n- Database should be created at `server/sudocode.db`\n- All tables should be created successfully\n- Can query tables with sqlite3\n\n## Success Criteria\nWorking SQLite database with all required tables.\n\nReference: [[server/server_plan.md]] - Phase 1, Step 1.2","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.095Z","created_at":"2025-10-24 09:53:37","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 10:18:01","parent_id":null,"relationships":[],"tags":["database","phase-1","schema","server"]}
{"id":"ISSUE-003","uuid":"827d2fb6-ce4d-4889-a53f-d93688057825","title":"Server: Read Issues from JSONL","content":"Load and serve issues from issues.jsonl file.\n\n## Tasks\n- [ ] Create `src/services/jsonl.ts` for JSONL operations\n- [ ] Implement `readIssuesJsonl(path)` function\n- [ ] Implement `parseIssueJsonl(line)` function\n- [ ] Create `src/services/issues.ts` for issue business logic\n- [ ] Create `src/routes/issues.ts` for issue routes\n- [ ] Implement GET `/api/tasks` (list issues)\n- [ ] Implement GET `/api/tasks/:id` (get issue by ID)\n- [ ] Add request validation and error handling\n\n## Files to Create\n```\nserver/src/\n├── routes/\n│   └── issues.ts         # Issue routes (mapped to /tasks)\n└── services/\n    ├── jsonl.ts          # JSONL read/write operations\n    └── issues.ts         # Issue business logic\n```\n\n## JSONL Operations\n```typescript\nexport async function readIssuesJsonl(path: string): Promise<IssueJSONL[]>\nexport async function writeIssuesJsonl(path: string, issues: IssueJSONL[]): Promise<void>\nexport function parseJsonlLine<T>(line: string): T | null\n```\n\n## API Response Format\n```typescript\ninterface ApiResponse<T> {\n  success: boolean\n  data: T | null\n  error_data?: any\n  message?: string\n}\n```\n\n## Verification\n```bash\ncurl http://localhost:3002/api/tasks\n# Should return issues from .sudocode/issues.jsonl\n\ncurl http://localhost:3002/api/tasks/ISSUE-001\n# Should return specific issue\n```\n\n## Success Criteria\nRead-only issues API that loads from JSONL files.\n\nReference: [[server/server_plan.md]] - Phase 3, Step 3.1","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.092Z","created_at":"2025-10-24 10:09:13","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 10:24:51","parent_id":null,"relationships":[],"tags":["api","issues","phase-3","server"]}
{"id":"ISSUE-004","uuid":"ac4048e7-32c5-424f-a7c7-23dde7909c9c","title":"Server: Sync Issues to SQLite Cache","content":"Load JSONL data into SQLite for fast queries. The CLI already maintains the cache.db, so the server should read from the existing database.\n\n## Tasks\n- [ ] Update issues service to read from SQLite instead of JSONL\n- [ ] Implement `getIssues()` to query from database\n- [ ] Implement `getIssueById(id)` to query from database\n- [ ] Handle relationships and tags from database\n- [ ] Add indexes for common queries if not already present\n- [ ] Update GET endpoints to read from SQLite\n- [ ] Handle case when database is not synced (warn user)\n\n## Database Queries\n```typescript\nexport async function getIssues(filters?: IssueFilters): Promise<Issue[]>\nexport async function getIssueById(id: string): Promise<Issue | null>\nexport async function getIssueRelationships(id: string): Promise<Relationship[]>\nexport async function getIssueTags(id: string): Promise<string[]>\n```\n\n## Verification\n```bash\n# Ensure CLI has synced data first\nsudocode sync\n\n# Start server\nnpm run dev\n\n# Query via API\ncurl http://localhost:3002/api/tasks\n# Should return issues from SQLite\n\n# Check database directly\nsqlite3 .sudocode/cache.db \"SELECT COUNT(*) FROM issues;\"\n```\n\n## Success Criteria\nIssues loaded from SQLite cache maintained by CLI, with fast query performance.\n\nReference: [[server/server_plan.md]] - Phase 3, Step 3.2","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.091Z","created_at":"2025-10-24 10:09:14","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 16:55:50","parent_id":null,"relationships":[],"tags":["database","issues","phase-3","server"]}
{"id":"ISSUE-005","uuid":"68030861-d410-4baf-b1dc-36f486862c5a","title":"Server: Create & Update Issues via API","content":"Implement write operations for issues, delegating to CLI operations for JSONL consistency.\n\n## Tasks\n- [ ] Implement POST `/api/tasks` (create issue)\n- [ ] Implement PUT `/api/tasks/:id` (update issue)\n- [ ] Use CLI operations from `@sudocode/cli` for consistency\n- [ ] Add request validation with Zod schemas\n- [ ] Handle validation errors gracefully\n- [ ] Return updated issue in response\n- [ ] Trigger sync after write operations\n\n## Integration with CLI\n```typescript\nimport { createIssue, updateIssue } from '@sudocode/cli/operations/issues'\n\nexport async function createIssueService(data: CreateIssueRequest): Promise<Issue> {\n  // Use CLI operation to create in JSONL\n  const issue = await createIssue(db, data)\n  \n  // CLI handles JSONL and SQLite sync\n  return issue\n}\n```\n\n## Request Validation\n```typescript\nconst createIssueSchema = z.object({\n  title: z.string().min(1).max(500),\n  description: z.string(),\n  status: z.enum(['open', 'in_progress', 'blocked', 'needs_review', 'closed']),\n  priority: z.number().min(0).max(4).optional(),\n  assignee: z.string().optional(),\n  tags: z.array(z.string()).optional(),\n})\n```\n\n## Verification\n```bash\n# Create new issue\ncurl -X POST http://localhost:3002/api/tasks \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"title\": \"Test Issue\", \"description\": \"Test\", \"status\": \"open\"}'\n\n# Update issue\ncurl -X PUT http://localhost:3002/api/tasks/ISSUE-001 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"status\": \"in_progress\"}'\n\n# Check issues.jsonl updated\ncat .sudocode/issues.jsonl | tail -1\n```\n\n## Success Criteria\nFull create and update operations for issues with JSONL persistence via CLI.\n\nReference: [[server/server_plan.md]] - Phase 3, Step 3.3","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.090Z","created_at":"2025-10-24 10:09:14","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 17:23:50","parent_id":null,"relationships":[],"tags":["api","crud","issues","phase-3","server"]}
{"id":"ISSUE-006","uuid":"5952bd3f-1731-4aa9-9ee0-3023570b8c75","title":"Server: Delete Issues via API","content":"Implement issue deletion with proper cascade handling.\n\n## Tasks\n- [ ] Implement DELETE `/api/tasks/:id`\n- [ ] Use CLI delete operation for consistency\n- [ ] Handle cascade deletion of relationships and tags\n- [ ] Add soft delete option (status='closed') as alternative\n- [ ] Return success response with deleted issue ID\n- [ ] Add confirmation requirement for destructive operations\n\n## Delete Operations\n```typescript\nexport async function deleteIssueService(id: string, soft: boolean = false): Promise<void> {\n  if (soft) {\n    // Soft delete: just close the issue\n    await updateIssue(db, id, { status: 'closed', closed_at: new Date().toISOString() })\n  } else {\n    // Hard delete: remove from JSONL and database\n    await deleteIssue(db, id)\n  }\n}\n```\n\n## API Design\n```typescript\n// Hard delete\nDELETE /api/tasks/:id\n\n// Soft delete (close)\nPUT /api/tasks/:id\n{ \"status\": \"closed\" }\n```\n\n## Verification\n```bash\n# Soft delete (close issue)\ncurl -X PUT http://localhost:3002/api/tasks/ISSUE-001 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"status\": \"closed\"}'\n\n# Hard delete\ncurl -X DELETE http://localhost:3002/api/tasks/ISSUE-001\n\n# Verify removed from JSONL and SQLite\ncat .sudocode/issues.jsonl | grep ISSUE-001\n# Should return nothing\n\nsqlite3 .sudocode/cache.db \"SELECT * FROM issues WHERE id='ISSUE-001';\"\n# Should return nothing\n```\n\n## Success Criteria\nComplete CRUD operations for issues with both hard and soft delete options.\n\nReference: [[server/server_plan.md]] - Phase 3, Step 3.4","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.089Z","created_at":"2025-10-24 10:09:14","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 17:33:04","parent_id":null,"relationships":[],"tags":["api","crud","issues","phase-3","server"]}
{"id":"ISSUE-007","uuid":"bff23a82-fea5-45e4-8519-ef2b01c1004c","title":"Server: Read Specs from JSONL","content":"Load and serve specs from specs.jsonl file, following the same pattern as the Issues API.\n\n## Tasks\n- [ ] Create `src/routes/specs.ts` for spec routes\n- [ ] Create `src/services/specs.ts` wrapping CLI operations\n- [ ] Implement GET `/api/specs` (list specs)\n- [ ] Implement GET `/api/specs/:id` (get spec by ID)\n- [ ] Use CLI operations from `@sudocode/cli` for consistency\n- [ ] Support filtering and pagination\n- [ ] Include relationships in response\n\n## Files to Create\n```\nserver/src/\n├── routes/\n│   └── specs.ts         # Spec routes (mapped to /api/specs)\n└── services/\n    └── specs.ts         # Spec business logic (wraps CLI)\n```\n\n## Integration with CLI\n```typescript\nimport { getSpec, listSpecs } from '@sudocode/cli/dist/operations/index.js'\n\nexport function getAllSpecs(db: Database.Database, options?: ListSpecsOptions): Spec[] {\n  return listSpecs(db, options || {})\n}\n\nexport function getSpecById(db: Database.Database, id: string): Spec | null {\n  return getSpec(db, id)\n}\n```\n\n## API Response Format\nSame as issues API:\n```typescript\ninterface ApiResponse<T> {\n  success: boolean\n  data: T | null\n  error_data?: any\n  message?: string\n}\n```\n\n## Verification\n```bash\ncurl http://localhost:3002/api/specs\n# Should return specs from SQLite\n\ncurl http://localhost:3002/api/specs/SPEC-001\n# Should return specific spec\n```\n\n## Success Criteria\nRead-only specs API that delegates to CLI operations, following the same patterns as Issues API.\n\nReference: [[server/server_plan.md]] - Phase 4, Step 4.1","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.088Z","created_at":"2025-10-24 17:50:33","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 18:04:49","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-008","uuid":"eccab6c9-845c-4271-9c2e-f436ec4247e7","title":"Server: Specs CRUD Operations","content":"Implement full create, update, and delete operations for specs via API.\n\n## Tasks\n- [ ] Implement POST `/api/specs` (create spec)\n- [ ] Implement PUT `/api/specs/:id` (update spec)\n- [ ] Implement DELETE `/api/specs/:id` (delete spec)\n- [ ] Use CLI operations from `@sudocode/cli` for consistency\n- [ ] Add request validation\n- [ ] Handle validation errors gracefully\n- [ ] Return created/updated spec in response\n- [ ] Add comprehensive tests for all CRUD operations\n\n## Integration with CLI\n```typescript\nimport { createSpec, updateSpec, deleteSpec } from '@sudocode/cli/dist/operations/index.js'\n\nexport function createNewSpec(db: Database.Database, input: CreateSpecInput): Spec {\n  return createSpec(db, input)\n}\n\nexport function updateExistingSpec(db: Database.Database, id: string, input: UpdateSpecInput): Spec {\n  return updateSpec(db, id, input)\n}\n\nexport function deleteExistingSpec(db: Database.Database, id: string): boolean {\n  return deleteSpec(db, id)\n}\n```\n\n## Request Validation\n- Title: required, max 500 characters\n- Content: optional markdown content\n- Priority: 0-4, default 2\n- Parent ID: optional, must exist if provided\n\n## Verification\n```bash\n# Create new spec\ncurl -X POST http://localhost:3002/api/specs \\\\\n  -H \"Content-Type: application/json\" \\\\\n  -d '{\"title\": \"Test Spec\", \"content\": \"# Spec content\"}'\n\n# Update spec\ncurl -X PUT http://localhost:3002/api/specs/SPEC-001 \\\\\n  -H \"Content-Type: application/json\" \\\\\n  -d '{\"content\": \"# Updated content\"}'\n\n# Delete spec\ncurl -X DELETE http://localhost:3002/api/specs/SPEC-001\n\n# Run tests\nnpm test\n```\n\n## Success Criteria\nFull CRUD operations for specs with CLI delegation and comprehensive test coverage.\n\nReference: [[server/server_plan.md]] - Phase 4, Step 4.2","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.087Z","created_at":"2025-10-24 17:50:34","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 18:13:32","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-009","uuid":"e3e058f4-d8b5-4260-b0a3-27fee8a7aa2c","title":"Server: Relationships API","content":"Manage relationships between issues and specs via REST API.\n\n## Tasks\n- [ ] Create `src/routes/relationships.ts` for relationship routes\n- [ ] Create `src/services/relationships.ts` wrapping CLI operations\n- [ ] Implement GET `/api/relationships?entity_id=X&entity_type=issue`\n- [ ] Implement POST `/api/relationships` (create relationship)\n- [ ] Implement DELETE `/api/relationships` (delete relationship)\n- [ ] Use CLI operations from `@sudocode/cli` for consistency\n- [ ] Add request validation\n- [ ] Add comprehensive tests\n\n## Integration with CLI\n```typescript\nimport { \n  getRelationships, \n  createRelationship, \n  deleteRelationship \n} from '@sudocode/cli/dist/operations/index.js'\n\nexport function getEntityRelationships(\n  db: Database.Database, \n  entityId: string, \n  entityType: EntityType\n): Relationship[] {\n  return getRelationships(db, entityId, entityType)\n}\n```\n\n## API Endpoints\n- `GET /api/relationships?entity_id=X&entity_type=issue` - Get relationships for entity\n- `POST /api/relationships` - Create relationship\n  ```json\n  {\n    \"from_id\": \"ISSUE-001\",\n    \"from_type\": \"issue\",\n    \"to_id\": \"SPEC-001\",\n    \"to_type\": \"spec\",\n    \"type\": \"implements\"\n  }\n  ```\n- `DELETE /api/relationships` - Delete relationship (same body as POST)\n\n## Relationship Types\n- `blocks` - Entity blocks another\n- `implements` - Issue implements spec\n- `references` - Entity references another\n- `depends-on` - Entity depends on another\n- `discovered-from` - Issue discovered from spec\n- `related` - Generic relationship\n\n## Verification\n```bash\n# Get relationships for an issue\ncurl http://localhost:3002/api/relationships?entity_id=ISSUE-001&entity_type=issue\n\n# Create relationship\ncurl -X POST http://localhost:3002/api/relationships \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"from_id\": \"ISSUE-001\", \"from_type\": \"issue\", \"to_id\": \"SPEC-001\", \"to_type\": \"spec\", \"type\": \"implements\"}'\n\n# Delete relationship\ncurl -X DELETE http://localhost:3002/api/relationships \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"from_id\": \"ISSUE-001\", \"from_type\": \"issue\", \"to_id\": \"SPEC-001\", \"to_type\": \"spec\", \"type\": \"implements\"}'\n```\n\n## Success Criteria\nRelationship management API with CLI delegation and full test coverage.\n\nReference: [[server/server_plan.md]] - Phase 5, Step 5.1","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.087Z","created_at":"2025-10-24 18:16:41","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 18:29:03","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-010","uuid":"79a841f8-d7df-4f2a-b5bb-3a4d2849fdef","title":"Server: Feedback API","content":"Manage issue feedback on specs via REST API.\n\n## Tasks\n- [ ] Create `src/routes/feedback.ts` for feedback routes\n- [ ] Create `src/services/feedback.ts` wrapping CLI operations\n- [ ] Implement GET `/api/feedback?spec_id=X` (list feedback for spec)\n- [ ] Implement GET `/api/feedback/:id` (get specific feedback)\n- [ ] Implement POST `/api/feedback` (add feedback)\n- [ ] Implement PUT `/api/feedback/:id` (update feedback)\n- [ ] Implement DELETE `/api/feedback/:id` (delete feedback)\n- [ ] Handle feedback anchors (line numbers, text snippets, section headings)\n- [ ] Use CLI operations from `@sudocode/cli` for consistency\n- [ ] Add request validation\n- [ ] Add comprehensive tests\n\n## Integration with CLI\n```typescript\nimport { \n  getFeedback, \n  createFeedback, \n  updateFeedback, \n  deleteFeedback \n} from '@sudocode/cli/dist/operations/index.js'\n\nexport function getSpecFeedback(\n  db: Database.Database, \n  specId: string\n): Feedback[] {\n  return getFeedback(db, specId)\n}\n```\n\n## API Endpoints\n- `GET /api/feedback?spec_id=SPEC-001` - List feedback for a spec\n- `GET /api/feedback/:id` - Get specific feedback\n- `POST /api/feedback` - Create feedback\n  ```json\n  {\n    \"issue_id\": \"ISSUE-001\",\n    \"spec_id\": \"SPEC-001\",\n    \"type\": \"comment\",\n    \"content\": \"Great spec!\",\n    \"anchor\": {\n      \"section_heading\": \"Overview\",\n      \"line_number\": 42,\n      \"text_snippet\": \"some text\",\n      \"anchor_status\": \"valid\"\n    }\n  }\n  ```\n- `PUT /api/feedback/:id` - Update feedback\n- `DELETE /api/feedback/:id` - Delete feedback\n\n## Feedback Types\n- `comment` - General comment\n- `suggestion` - Suggestion for improvement\n- `request` - Request for clarification\n\n## Feedback Anchor\n```typescript\ninterface FeedbackAnchor {\n  section_heading?: string\n  line_number?: number\n  text_snippet?: string\n  anchor_status: 'valid' | 'relocated' | 'stale'\n}\n```\n\n## Verification\n```bash\n# Get feedback for spec\ncurl http://localhost:3002/api/feedback?spec_id=SPEC-001\n\n# Create feedback\ncurl -X POST http://localhost:3002/api/feedback \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"issue_id\": \"ISSUE-001\", \"spec_id\": \"SPEC-001\", \"type\": \"comment\", \"content\": \"Nice work!\", \"anchor\": {\"line_number\": 10, \"anchor_status\": \"valid\"}}'\n\n# Update feedback\ncurl -X PUT http://localhost:3002/api/feedback/fb-123 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"content\": \"Updated comment\"}'\n\n# Delete feedback\ncurl -X DELETE http://localhost:3002/api/feedback/fb-123\n\n# Run tests\nnpm test\n```\n\n## Success Criteria\nFeedback management API with anchor support, CLI delegation, and full test coverage.\n\nReference: [[server/server_plan.md]] - Phase 5, Step 5.2","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.084Z","created_at":"2025-10-24 18:17:04","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 18:36:33","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-011","uuid":"0022dc0e-75e9-4e4b-842f-65cafcd74217","title":"Server: File Watcher Setup","content":"Watch JSONL files for external changes and trigger database sync.\n\n## Tasks\n- [ ] Create `src/services/watcher.ts` for file watching\n- [ ] Use `chokidar` to watch issues.jsonl and specs.jsonl\n- [ ] Debounce file change events (avoid multiple rapid syncs)\n- [ ] Trigger database sync on file change\n- [ ] Handle file rename/delete events\n- [ ] Add watcher to server startup\n\n## Implementation Details\n\nUse chokidar to watch for file system changes:\n```typescript\nimport chokidar from 'chokidar'\n\nexport function startFileWatcher(jsonlPath: string) {\n  const watcher = chokidar.watch([\n    `${jsonlPath}/issues.jsonl`,\n    `${jsonlPath}/specs.jsonl`,\n  ], {\n    persistent: true,\n    ignoreInitial: true,\n  })\n\n  watcher.on('change', debounce((path) => {\n    console.log(`File changed: ${path}`)\n    if (path.includes('issues.jsonl')) {\n      syncIssuesToDb(path)\n      broadcastIssueUpdate()\n    } else if (path.includes('specs.jsonl')) {\n      syncSpecsToDb(path)\n      broadcastSpecUpdate()\n    }\n  }, 1000))\n}\n```\n\n## Verification\n```bash\n# Start server\nnpm run dev\n\n# Manually edit .sudocode/issues.jsonl\n# Server logs should show \"File changed: issues.jsonl\"\n# Database should be re-synced\n```\n\n## Dependencies\n- chokidar package\n- Existing sync functions from CLI\n\n## Success Criteria\nAutomatic database sync when JSONL files change externally.\n\nReference: [[server/server_plan.md]] - Phase 6, Step 6.1","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.066Z","created_at":"2025-10-24 18:41:25","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-25 02:42:16","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-012","uuid":"803e1739-35ba-4bd6-924a-b70f34d10cf4","title":"Server: WebSocket Server Setup","content":"Set up WebSocket server for real-time client updates.\n\n## Tasks\n- [ ] Create `src/services/websocket.ts` for WebSocket management\n- [ ] Initialize WebSocket server with `ws` library\n- [ ] Handle client connections and disconnections\n- [ ] Implement connection management (track clients)\n- [ ] Add heartbeat/ping-pong to detect dead connections\n- [ ] Implement subscription system (clients subscribe to projects/entities)\n- [ ] Integrate with Express server\n\n## Implementation Details\n\nWebSocket server setup:\n```typescript\nimport { WebSocketServer, WebSocket } from 'ws'\n\ninterface Client {\n  id: string\n  ws: WebSocket\n  subscriptions: string[]  // e.g., ['project:uuid', 'issue:ISSUE-001']\n}\n\nconst clients = new Map<string, Client>()\n\nexport function initWebSocketServer(server: http.Server) {\n  const wss = new WebSocketServer({ server, path: '/ws' })\n\n  wss.on('connection', (ws, req) => {\n    const clientId = generateId()\n    clients.set(clientId, { id: clientId, ws, subscriptions: [] })\n\n    ws.on('message', (data) => {\n      const message = JSON.parse(data.toString())\n      handleClientMessage(clientId, message)\n    })\n\n    ws.on('close', () => {\n      clients.delete(clientId)\n    })\n\n    // Heartbeat\n    ws.on('pong', () => {\n      client.isAlive = true\n    })\n  })\n\n  // Check for dead connections every 30s\n  setInterval(() => {\n    clients.forEach((client) => {\n      if (!client.isAlive) {\n        client.ws.terminate()\n        clients.delete(client.id)\n        return\n      }\n      client.isAlive = false\n      client.ws.ping()\n    })\n  }, 30000)\n}\n```\n\n## Message Protocol\n\nClient -> Server:\n```json\n{\n  \"type\": \"subscribe\",\n  \"entity_type\": \"issue\",\n  \"entity_id\": \"ISSUE-001\"\n}\n```\n\nServer -> Client:\n```json\n{\n  \"type\": \"issue_updated\",\n  \"data\": { \"id\": \"ISSUE-001\", ... }\n}\n```\n\n## Verification\n```bash\n# Use wscat to test\nnpm install -g wscat\nwscat -c ws://localhost:3002/ws\n# Should connect successfully\n> {\"type\": \"ping\"}\n# Should receive pong\n```\n\n## Dependencies\n- ws package\n- uuid for client IDs\n\n## Success Criteria\nWebSocket server accepting and managing client connections with heartbeat.\n\nReference: [[server/server_plan.md]] - Phase 6, Step 6.2","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.082Z","created_at":"2025-10-24 18:41:26","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 21:47:26","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-013","uuid":"7089f51c-758f-44fd-8183-a886b4876b7f","title":"Server: Real-Time Issue Updates","content":"Broadcast issue changes to connected WebSocket clients in real-time.\n\n## Tasks\n- [ ] Implement issue update broadcasting in `src/services/websocket.ts`\n- [ ] Broadcast updates on issue CRUD operations\n- [ ] Broadcast updates when file watcher detects changes\n- [ ] Add filtering (only send to subscribed clients)\n- [ ] Support subscription to specific issues or all issues\n- [ ] Handle different update types (created/updated/deleted)\n\n## Implementation Details\n\nBroadcasting logic:\n```typescript\nexport function broadcastIssueUpdate(\n  issue: Issue,\n  type: 'created' | 'updated' | 'deleted'\n) {\n  const message = {\n    type: `issue_${type}`,\n    data: issue,\n    timestamp: new Date().toISOString(),\n  }\n\n  clients.forEach((client) => {\n    const subscribed = client.subscriptions.some(sub => \n      sub === 'issues:all' || \n      sub === `issue:${issue.id}` ||\n      (issue.project_id && sub === `project:${issue.project_id}`)\n    )\n    \n    if (subscribed) {\n      client.ws.send(JSON.stringify(message))\n    }\n  })\n}\n```\n\nIntegration points:\n1. Call from routes after CRUD operations\n2. Call from file watcher on external changes\n3. Support filtering by project_id\n\n## Message Types\n\n- `issue_created` - New issue created\n- `issue_updated` - Issue modified\n- `issue_deleted` - Issue removed\n\n## Verification\n```bash\n# Connect with wscat\nwscat -c ws://localhost:3002/ws\n> {\"type\": \"subscribe\", \"entity_type\": \"issues\"}\n\n# In another terminal, create an issue\ncurl -X POST http://localhost:3002/api/issues -d '{\"title\": \"Test\"}'\n\n# wscat should receive update message\n< {\"type\": \"issue_created\", \"data\": {...}}\n```\n\n## Integration\n- Modify `src/routes/issues.ts` to call broadcast functions\n- Connect with file watcher from ISSUE-011\n\n## Success Criteria\nConnected clients receive real-time updates when issues change.\n\nReference: [[server/server_plan.md]] - Phase 6, Step 6.3","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.080Z","created_at":"2025-10-24 18:41:26","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 22:13:03","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-014","uuid":"916d44ca-42fa-4af9-a2a3-3aea6499ec9b","title":"Server: Real-Time Spec Updates","content":"Broadcast spec changes to connected WebSocket clients in real-time.\n\n## Tasks\n- [ ] Implement spec update broadcasting in `src/services/websocket.ts`\n- [ ] Broadcast updates on spec CRUD operations\n- [ ] Broadcast updates when file watcher detects changes\n- [ ] Add filtering (only send to subscribed clients)\n- [ ] Support subscription to specific specs or all specs\n- [ ] Handle different update types (created/updated/deleted)\n\n## Implementation Details\n\nBroadcasting logic:\n```typescript\nexport function broadcastSpecUpdate(\n  spec: Spec,\n  type: 'created' | 'updated' | 'deleted'\n) {\n  const message = {\n    type: `spec_${type}`,\n    data: spec,\n    timestamp: new Date().toISOString(),\n  }\n\n  clients.forEach((client) => {\n    const subscribed = client.subscriptions.some(sub => \n      sub === 'specs:all' || \n      sub === `spec:${spec.id}` ||\n      (spec.project_id && sub === `project:${spec.project_id}`)\n    )\n    \n    if (subscribed) {\n      client.ws.send(JSON.stringify(message))\n    }\n  })\n}\n```\n\nIntegration points:\n1. Call from routes after CRUD operations\n2. Call from file watcher on external changes\n3. Support filtering by project_id\n\n## Message Types\n\n- `spec_created` - New spec created\n- `spec_updated` - Spec modified\n- `spec_deleted` - Spec removed\n\n## Verification\n```bash\n# Connect with wscat\nwscat -c ws://localhost:3002/ws\n> {\"type\": \"subscribe\", \"entity_type\": \"specs\"}\n\n# In another terminal, create a spec\ncurl -X POST http://localhost:3002/api/specs -d '{\"title\": \"Test Spec\"}'\n\n# wscat should receive update message\n< {\"type\": \"spec_created\", \"data\": {...}}\n```\n\n## Integration\n- Modify `src/routes/specs.ts` to call broadcast functions\n- Connect with file watcher from ISSUE-011\n- Consider broadcasting relationship and feedback updates\n\n## Success Criteria\nConnected clients receive real-time updates when specs change.\n\nReference: [[server/server_plan.md]] - Phase 6, Step 6.4","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.074Z","created_at":"2025-10-24 18:41:27","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 22:49:06","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-015","uuid":"0483ddd8-d2ff-4d22-8f5a-4d4ddbbfc925","title":"Import should preserve timestamps from JSONL","content":"When importing from JSONL, updateIssue/updateSpec always generate new updated_at timestamps. This causes JSONL files to be modified even when content hasn't changed, breaking the bidirectional sync content-matching optimization.","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.083Z","created_at":"2025-10-24 21:16:59","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 21:35:58","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-016","uuid":"e0dc4e55-aa7b-4666-b41a-510a8a5541b0","title":"Frontend Setup: Create workspace and configure build tools","content":"Set up the frontend workspace with Vite, React, and TypeScript, following the architecture outlined in [[server/ui.md]].\n\n## Tasks\n- [ ] Create `frontend/` directory in monorepo root\n- [ ] Initialize package.json with dependencies from ui.md\n- [ ] Configure Vite with React plugin and path aliases\n- [ ] Set up TypeScript with strict mode\n- [ ] Configure Tailwind CSS + PostCSS\n- [ ] Add shadcn/ui components configuration\n- [ ] Update root package.json to include frontend workspace\n- [ ] Add build and dev scripts\n\n## Dependencies\nCore:\n- React 18.2, React DOM\n- TypeScript 5.5+\n- Vite 5\n\nUI/Styling:\n- Tailwind CSS 3.4\n- shadcn/ui components (Radix UI primitives)\n- Lucide React icons\n\nSee server/ui.md lines 210-292 for complete dependency list.\n\n## Acceptance Criteria\n- `npm run dev --workspace=frontend` starts Vite dev server on port 3000\n- TypeScript compiles without errors\n- Tailwind CSS is working\n- Hot module replacement is functional","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.081Z","created_at":"2025-10-24 22:00:42","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 22:07:34","parent_id":null,"relationships":[],"tags":["frontend","infrastructure","setup"]}
{"id":"ISSUE-017","uuid":"f91867e7-b587-432b-899a-07a72bf525cd","title":"Server: Add static file serving for production frontend","content":"Update Express server to serve built frontend assets in production mode, following the pattern in [[server/ui.md]].\n\n## Tasks\n- [ ] Add static file serving middleware for frontend/dist\n- [ ] Add SPA fallback route to serve index.html for non-API routes\n- [ ] Ensure API routes are registered before static serving\n- [ ] Add production check (NODE_ENV === 'production')\n- [ ] Resolve port configuration (currently 3002, ui.md references 3001)\n- [ ] Document production build process\n\n## Implementation\n```typescript\n// server/src/index.ts (after API routes)\nif (process.env.NODE_ENV === 'production') {\n  const frontendPath = path.join(__dirname, '../../frontend/dist');\n  app.use(express.static(frontendPath));\n  \n  app.get('*', (req, res) => {\n    res.sendFile(path.join(frontendPath, 'index.html'));\n  });\n}\n```\n\n## Acceptance Criteria\n- Built frontend is served at http://localhost:3002/\n- API routes still work at http://localhost:3002/api/*\n- WebSocket endpoint still works at ws://localhost:3002/ws\n- SPA routing works (refresh on /projects, /issues, etc.)","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.077Z","created_at":"2025-10-24 22:00:42","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 22:22:36","parent_id":null,"relationships":[],"tags":["infrastructure","production","server"]}
{"id":"ISSUE-018","uuid":"79a69058-fa37-4b1a-bec5-533fb55892e6","title":"Frontend: Implement API client and WebSocket infrastructure","content":"Build the core API client layer with axios and WebSocket support, as designed in [[server/ui.md]] lines 470-670.\n\n## Tasks\n- [ ] Create `lib/api.ts` with axios instance and interceptors\n- [ ] Implement response unwrapping for ApiResponse wrapper\n- [ ] Create API modules: issuesApi, specsApi, relationshipsApi, feedbackApi\n- [ ] Create `lib/websocket.ts` with useWebSocket hook\n- [ ] Add environment variable support (VITE_API_URL, VITE_WS_URL)\n- [ ] Add error handling and logging\n- [ ] Create TypeScript types in `types/api.ts`\n\n## API Structure\n```typescript\nexport const issuesApi = {\n  getAll: (projectId?: string) => get<Issue[]>('/issues'),\n  getById: (id: string) => get<Issue>(\\`/issues/\\${id}\\`),\n  create: (data: CreateIssueRequest) => post<Issue>('/issues', data),\n  update: (id: string, data: UpdateIssueRequest) => put<Issue>(\\`/issues/\\${id}\\`, data),\n  delete: (id: string) => del(\\`/issues/\\${id}\\`)\n}\n```\n\n## Acceptance Criteria\n- API client successfully connects to server\n- Response unwrapping works correctly\n- WebSocket connection establishes and receives messages\n- Type safety for all API calls\n- Error handling with user-friendly messages","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.076Z","created_at":"2025-10-24 22:00:42","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 22:47:32","parent_id":null,"relationships":[],"tags":["api","frontend","infrastructure"]}
{"id":"ISSUE-019","uuid":"9947c91e-e3fb-4d94-9ad4-e0cde902b59a","title":"Frontend: Set up routing and application shell","content":"Implement React Router structure, providers, and main application layout per [[server/ui.md]] lines 747-788.\n\n## Tasks\n- [ ] Create `App.tsx` with QueryClientProvider, ThemeProvider, BrowserRouter\n- [ ] Set up React Router routes structure\n- [ ] Create page components: ProjectsPage, IssuesPage, SpecsPage\n- [ ] Create MainLayout component with outlet\n- [ ] Implement ProjectContext for current project state\n- [ ] Implement ThemeContext for dark/light mode\n- [ ] Configure TanStack Query with default options\n- [ ] Add route-based code splitting\n\n## Route Structure\n```\n/ → redirect to /projects\n/projects → Project list\n/projects/:id/issues → Issue kanban board\n/projects/:id/specs → Spec list\n/projects/:id/specs/:specId → Spec detail view\n/settings/* → Settings pages\n```\n\n## Acceptance Criteria\n- All routes render without errors\n- Navigation between routes works\n- QueryClient is configured with proper caching\n- Context providers accessible throughout app\n- Theme switching works (if implemented)","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.072Z","created_at":"2025-10-24 22:00:42","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 23:06:42","parent_id":null,"relationships":[],"tags":["frontend","infrastructure","routing"]}
{"id":"ISSUE-020","uuid":"20b4d501-8102-4261-996c-9af16d30ea5e","title":"Frontend: Build core layout components","content":"Implement the main layout structure with header, sidebar, and responsive containers following [[server/ui.md]] component architecture.\n\n## Tasks\n- [ ] Create `components/layout/MainLayout.tsx` - Main wrapper with outlets\n- [ ] Create `components/layout/Header.tsx` - Top navigation bar\n- [ ] Create `components/layout/Sidebar.tsx` - Left navigation sidebar\n- [ ] Create `components/layout/PanelLayout.tsx` - Slide-out panel system\n- [ ] Add Lucide React icons for navigation\n- [ ] Implement responsive breakpoints\n- [ ] Add keyboard navigation support\n- [ ] Style with Tailwind utilities\n\n## Features\n- Header: Logo, project selector, search, settings\n- Sidebar: Navigation links (Issues, Specs, Settings)\n- Panel system: Reusable slide-out panels for details\n- Responsive: Mobile-friendly collapsible sidebar\n\n## Acceptance Criteria\n- Layout renders correctly on desktop and mobile\n- Sidebar can be toggled open/closed\n- Navigation links highlight active route\n- Panel system can open/close smoothly\n- Accessible keyboard navigation","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.071Z","created_at":"2025-10-24 22:00:42","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 23:18:08","parent_id":null,"relationships":[],"tags":["components","frontend","layout"]}
{"id":"ISSUE-021","uuid":"b71ce905-f767-4ccf-9f88-3eb6612a7bd9","title":"Frontend: Implement issue kanban board (MVP)","content":"Build the core kanban board for issues with drag-and-drop, following the example in [[server/ui.md]] lines 675-743.\n\n## Tasks\n- [ ] Install @dnd-kit/core, @dnd-kit/sortable\n- [ ] Create `components/ui/kanban/` primitives (Board, Column, Card)\n- [ ] Create `components/issues/IssueKanbanBoard.tsx` - Main board\n- [ ] Create `components/issues/IssueCard.tsx` - Individual issue card\n- [ ] Create `components/issues/IssuePanel.tsx` - Detail slide-out panel\n- [ ] Implement useIssues hook with TanStack Query\n- [ ] Add WebSocket live updates for issue changes\n- [ ] Add drag-and-drop to change status\n- [ ] Style cards with priority badges and status indicators\n\n## Kanban Columns\n- Open → In Progress → Blocked → Closed\n\n## Acceptance Criteria\n- Issues load and display in correct columns\n- Drag-and-drop updates issue status via API\n- WebSocket updates reflect changes from other clients\n- Issue card shows: title, ID, priority, description preview\n- Click card opens detail panel\n- Optimistic updates with error handling","status":"closed","priority":2,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.070Z","created_at":"2025-10-24 22:00:43","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-24 23:56:58","parent_id":null,"relationships":[],"tags":["frontend","issues","kanban","mvp"]}
{"id":"ISSUE-022","uuid":"1b1aa9c7-5984-4b46-9d9f-ae46dfde265f","title":"Frontend: Implement issue CRUD operations and forms","content":"Build issue creation, editing, and deletion UI with form validation.\n\n## Tasks\n- [ ] Create `components/issues/IssueEditor.tsx` - Create/edit form\n- [ ] Add markdown editor support (react-markdown or Lexical)\n- [ ] Implement issue creation dialog\n- [ ] Implement issue edit mode in panel\n- [ ] Add delete confirmation dialog\n- [ ] Implement priority selector (0-4)\n- [ ] Implement status selector\n- [ ] Add form validation\n- [ ] Connect to issuesApi mutations\n\n## Form Fields\n- Title (required)\n- Description (markdown)\n- Status (open/in_progress/blocked/closed)\n- Priority (0=highest to 4=lowest)\n- Tags (optional)\n- Parent issue (optional for relationships)\n\n## Acceptance Criteria\n- Can create new issues from kanban board\n- Can edit existing issues from detail panel\n- Can delete issues with confirmation\n- Form validates required fields\n- Markdown preview works\n- Mutations update QueryClient cache","status":"closed","priority":2,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.068Z","created_at":"2025-10-24 22:00:43","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-25 00:20:17","parent_id":null,"relationships":[],"tags":["forms","frontend","issues","mvp"]}
{"id":"ISSUE-024","uuid":"feea9e38-7b61-4906-ab17-cbe2a7efb8f6","title":"Frontend: Implement feedback anchoring UI","content":"Build the feedback system for anchoring comments to spec lines, as designed in [[server/ui.md]].\n\n## Tasks\n- [ ] Create `components/specs/SpecFeedbackPanel.tsx` - Feedback sidebar\n- [ ] Create `components/specs/FeedbackAnchor.tsx` - Visual anchor on lines\n- [ ] Create `components/specs/FeedbackCard.tsx` - Individual feedback item\n- [ ] Create `components/specs/FeedbackForm.tsx` - Add feedback form\n- [ ] Implement useFeedback hook\n- [ ] Add click-to-anchor interaction on spec lines\n- [ ] Add line/text-based anchoring logic\n- [ ] Connect to feedbackApi\n- [ ] Add feedback type badges (comment/suggestion/request)\n\n## Feedback Features\n- Click spec line to add feedback\n- Feedback anchored by line number or text snippet\n- Visual indicators on lines with feedback\n- Sidebar shows all feedback for spec\n- Link feedback to issues\n\n## Acceptance Criteria\n- Can click line to add feedback\n- Feedback displays with correct anchor\n- Visual indicators show lines with feedback\n- Can view and navigate all feedback for a spec\n- Can link feedback to issues\n- Feedback persists across page reloads","status":"closed","priority":3,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.064Z","created_at":"2025-10-24 22:00:43","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-25 08:55:22","parent_id":null,"relationships":[],"tags":["feedback","frontend","phase-2","specs"]}
{"id":"ISSUE-025","uuid":"c6ca5565-9ac7-4608-8b8d-9618eaccb164","title":"Frontend: Implement relationship visualization","content":"Build UI for viewing and creating relationships between specs and issues.\n\n## Tasks\n- [x] Create relationship utilities and helpers (`lib/relationships.ts`)\n- [x] Create `components/relationships/RelationshipList.tsx` - List view\n- [x] Create `components/relationships/RelationshipForm.tsx` - Create link form\n- [x] Integrate relationships into IssuePanel\n- [ ] Create `components/panels/RelationshipPanel.tsx` - Side panel (optional)\n- [ ] Create `components/relationships/RelationshipGraph.tsx` - Visual graph (deferred to future)\n- [ ] Add graph visualization library (deferred to future)\n- [ ] Integrate relationships into SpecViewer\n\n## Completed Features\n- ✅ Relationship type badges with color coding\n- ✅ List view showing outgoing/incoming relationships\n- ✅ Form for creating new relationships\n- ✅ Delete relationship functionality\n- ✅ Integrated into Issue Panel\n- ✅ Connected to relationshipsApi\n\n## Relationship Types\n- blocks\n- implements\n- references\n- depends-on\n- discovered-from\n- related\n\n## Acceptance Criteria\n- ✅ Can view relationships for issues\n- ✅ Relationship types clearly indicated with color-coded badges\n- ✅ Can create new relationships between entities\n- ✅ Can delete relationships\n- ⏳ Can view relationships for specs (pending SpecViewer integration)\n- ⏳ Can navigate to related entities (partially implemented)\n- ⏳ Graph visualization (deferred to future phase)","status":"closed","priority":4,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.062Z","created_at":"2025-10-24 22:00:43","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-27 00:23:55","parent_id":null,"relationships":[{"from":"ISSUE-025","from_type":"issue","to":"ISSUE-021","to_type":"issue","type":"depends-on"},{"from":"ISSUE-025","from_type":"issue","to":"ISSUE-021","to_type":"issue","type":"references"}],"tags":["frontend","phase-2","relationships"]}
{"id":"ISSUE-026","uuid":"b03a982b-d66c-4561-bd89-1f5311c5eea4","title":"Frontend: Add dark mode support","content":"Implement dark/light theme switching with system preference detection.\n\n## Tasks\n- [x] Set up CSS variables for theme colors\n- [x] Configure Tailwind dark mode (class strategy)\n- [x] Implement ThemeContext with localStorage persistence\n- [x] Add theme toggle component in header\n- [x] Add system preference detection\n- [x] Update all components to support dark mode\n- [x] Test contrast and accessibility\n- [ ] Add smooth transitions between themes\n\n## Fixes Applied\n- Added missing chart color CSS variables (--chart-1 through --chart-5) for both light and dark modes\n- Fixed priority badge colors in IssueCard and SpecCard to use darker shades (600/700 variants) for better contrast with white text\n- Fixed FeedbackAnchor badge colors for better contrast in both themes\n- Changed kanban board outline from hard-coded black to theme-aware border color\n\n## Theme Colors (from ui.md)\n- Define HSL color variables for light/dark\n- Use Tailwind's dark: prefix for dark mode styles\n- shadcn/ui components support dark mode by default\n\n## Acceptance Criteria\n- Theme toggle button switches themes instantly\n- Theme preference persists in localStorage\n- Respects system preference on first visit\n- All components render correctly in both themes\n- Smooth transition animation between themes\n- Accessible contrast ratios in both modes","status":"closed","priority":4,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.062Z","created_at":"2025-10-24 22:00:44","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-26 23:00:03","parent_id":null,"relationships":[],"tags":["accessibility","frontend","polish","ui"]}
{"id":"ISSUE-028","uuid":"060368aa-be35-492e-b410-b44ddbcca9d2","title":"Database schema and TypeScript types for executions","content":"Implement the database schema for the executions table and corresponding TypeScript types/interfaces.\n\n## Tasks\n\n- [ ] Create SQLite migration for executions table\n- [ ] Add TypeScript types: `Execution`, `AgentType`, `ExecutionStatus`\n- [ ] Create database helper functions: `createExecution`, `getExecution`, `updateExecution`\n- [ ] Write unit tests for database operations\n\n## Schema\n\n```sql\nCREATE TABLE executions (\n  id TEXT PRIMARY KEY,\n  issue_id TEXT NOT NULL REFERENCES issues(id) ON DELETE CASCADE,\n  agent_type TEXT NOT NULL,\n  status TEXT NOT NULL,\n  \n  started_at INTEGER NOT NULL,\n  completed_at INTEGER,\n  exit_code INTEGER,\n  \n  before_commit TEXT,\n  after_commit TEXT,\n  \n  session_id TEXT,\n  prompt TEXT,\n  summary TEXT,\n  \n  created_at INTEGER NOT NULL DEFAULT (unixepoch()),\n  updated_at INTEGER NOT NULL DEFAULT (unixepoch())\n);\n\nCREATE INDEX idx_executions_issue_id ON executions(issue_id);\nCREATE INDEX idx_executions_status ON executions(status);\nCREATE INDEX idx_executions_session_id ON executions(session_id);\n```\n\n## Acceptance Criteria\n\n- Migration runs successfully\n- Types match database schema exactly\n- Can create, read, and update executions\n- All tests pass\n\nImplements [[SPEC-001]] Phase 1","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.059Z","created_at":"2025-10-27 00:09:52","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-27 03:14:59","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-029","uuid":"5ec59582-8d3e-448c-a5f0-1f8bafe3abb9","title":"Implement ExecutionManager class for process lifecycle management","content":"Create the core ExecutionManager class that handles spawning, monitoring, and stopping agent processes.\n\n## Tasks\n\n- [ ] Create `ExecutionManager` class in `server/src/execution/`\n- [ ] Implement `startExecution(issueId, agentType, prompt)` method\n- [ ] Implement `stopExecution(executionId)` method\n- [ ] Implement `getExecutionStatus(executionId)` method\n- [ ] Track running processes in memory (Map<executionId, ChildProcess>)\n- [ ] Handle process lifecycle events (spawn, exit, error)\n- [ ] Write stdout/stderr to temp files\n- [ ] Update database with status changes\n- [ ] Write unit tests\n\n## Key Responsibilities\n\n1. **Process Spawning**: Start agent processes with correct arguments\n2. **Process Tracking**: Maintain in-memory map of running processes\n3. **Status Updates**: Update database when status changes\n4. **Log Storage**: Write raw logs to temp files\n5. **Cleanup**: Handle process termination and cleanup\n\n## Dependencies\n\n- [[ISSUE-028]] - Database schema must be ready\n\n## Example Usage\n\n```typescript\nconst manager = new ExecutionManager(db);\n\n// Start execution\nconst executionId = await manager.startExecution(\n  'issue-123',\n  'claude-code',\n  'Fix the bug in auth.ts'\n);\n\n// Check status\nconst status = await manager.getExecutionStatus(executionId);\n// { id: 'exec-abc', status: 'running', ... }\n\n// Stop execution\nawait manager.stopExecution(executionId);\n```\n\nImplements [[SPEC-001]] Phase 1","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.059Z","created_at":"2025-10-27 00:11:11","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-27 04:15:54","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-030","uuid":"a690a530-a4b6-4554-9391-32afd81f95f0","title":"Implement basic Claude Code process spawning","content":"Implement the ability to spawn Claude Code processes with correct arguments and environment.\n\n## Tasks\n\n- [ ] Create utility function `spawnClaudeCode(workDir, prompt)` \n- [ ] Configure correct npx command and arguments\n- [ ] Set up stdio pipes (stdin, stdout, stderr)\n- [ ] Send prompt via stdin and close\n- [ ] Return ChildProcess instance\n- [ ] Handle spawn errors gracefully\n- [ ] Add logging for debugging\n- [ ] Write integration tests\n\n## Command to Spawn\n\n```bash\nnpx -y @anthropic-ai/claude-code@latest \\\n  -p \\\n  --output-format=stream-json \\\n  --include-partial-messages \\\n  --verbose\n```\n\n## Implementation Notes\n\n- Use `spawn` from Node's `child_process`\n- Set `cwd` to work directory (for now, use repo root)\n- Capture stdout/stderr separately\n- Write prompt to stdin, then end stream\n- Don't normalize logs yet (Phase 2)\n\n## Dependencies\n\nNone - can be implemented independently\n\nImplements [[SPEC-001]] Phase 1","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.053Z","created_at":"2025-10-27 00:11:12","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-27 04:33:32","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-031","uuid":"8fa52422-4f5b-4d0d-9bcb-172dcce12f90","title":"API endpoints for execution management","content":"Create REST API endpoints for starting, stopping, and monitoring executions.\n\n## Tasks\n\n- [ ] Create `server/src/routes/executions.ts`\n- [ ] Implement `POST /api/issues/:issueId/executions` - Start execution\n- [ ] Implement `GET /api/executions/:executionId` - Get status\n- [ ] Implement `POST /api/executions/:executionId/stop` - Stop execution\n- [ ] Implement `GET /api/issues/:issueId/executions` - List executions for issue\n- [ ] Add request validation\n- [ ] Add error handling\n- [ ] Update API types in `server/src/types/api.ts`\n- [ ] Write integration tests\n\n## Endpoints\n\n### Start Execution\n```\nPOST /api/issues/:issueId/executions\nBody: { \"agentType\": \"claude-code\", \"prompt\": \"Fix the bug\" }\nResponse: { \"executionId\": \"exec-123\" }\n```\n\n### Get Execution Status\n```\nGET /api/executions/:executionId\nResponse: {\n  \"id\": \"exec-123\",\n  \"issueId\": \"issue-456\",\n  \"agentType\": \"claude-code\",\n  \"status\": \"running\",\n  \"startedAt\": \"2025-01-26T10:00:00Z\",\n  ...\n}\n```\n\n### Stop Execution\n```\nPOST /api/executions/:executionId/stop\nResponse: { \"status\": \"killed\" }\n```\n\n### List Executions\n```\nGET /api/issues/:issueId/executions\nResponse: { \"executions\": [...] }\n```\n\n## Dependencies\n\n- [[ISSUE-028]] - Database schema\n- [[ISSUE-029]] - ExecutionManager class\n\nImplements [[SPEC-001]] Phase 1\n","status":"open","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:03:15.815Z","created_at":"2025-10-27 00:11:13","updated_at":"2025-10-28 19:03:15","closed_at":null,"parent_id":null,"relationships":[{"from":"ISSUE-031","from_type":"issue","to":"ISSUE-028","to_type":"issue","type":"references"},{"from":"ISSUE-031","from_type":"issue","to":"ISSUE-029","to_type":"issue","type":"references"},{"from":"ISSUE-031","from_type":"issue","to":"SPEC-001","to_type":"spec","type":"references"}],"tags":[]}
{"id":"ISSUE-032","uuid":"64f7faef-eab5-4214-95c8-00001ce87870","title":"Raw log storage in temp files","content":"Implement system for storing raw stdout/stderr from agent processes in temporary files for later processing.\n\n## Tasks\n\n- [ ] Create temp directory structure for logs (e.g., `.sudocode/tmp/executions/{executionId}/`)\n- [ ] Stream stdout to `stdout.log` file\n- [ ] Stream stderr to `stderr.log` file  \n- [ ] Handle file write errors\n- [ ] Implement cleanup on execution completion\n- [ ] Add configurable retention policy (default: keep for 24 hours)\n- [ ] Create utility functions: `getExecutionLogPath()`, `readExecutionLogs()`\n- [ ] Write tests for log storage\n\n## File Structure\n\n```\n.sudocode/tmp/executions/\n  exec-abc-123/\n    stdout.log\n    stderr.log\n  exec-def-456/\n    stdout.log\n    stderr.log\n```\n\n## Implementation Notes\n\n- Use Node's `fs.createWriteStream()` for efficient streaming\n- Create directories with `fs.mkdir({ recursive: true })`\n- Store logs until execution completes + retention period\n- In Phase 2, we'll parse these logs for normalization\n- For now, just preserve raw output\n\n## Dependencies\n\nNone - can be implemented independently\n\nImplements [[SPEC-001]] Phase 1","status":"open","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:03:18.430Z","created_at":"2025-10-27 00:11:14","updated_at":"2025-10-28 19:03:18","closed_at":null,"parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-033","uuid":"e3ed54c5-9be7-409a-acd5-646fbc4e9984","title":"Integration test for Phase 1 MVP","content":"Create end-to-end integration test that validates the complete Phase 1 execution flow.\n\n## Tasks\n\n- [ ] Create test file `server/tests/integration/executions.test.ts`\n- [ ] Test: Start execution via API\n- [ ] Test: Verify execution appears in database\n- [ ] Test: Check execution status via API\n- [ ] Test: Verify raw logs are written to temp files\n- [ ] Test: Stop execution via API\n- [ ] Test: Verify final status is 'killed' or 'completed'\n- [ ] Test: List executions for an issue\n- [ ] Add cleanup after tests (delete temp files, database rows)\n- [ ] Document test setup and teardown\n\n## Test Scenario\n\n```typescript\ndescribe('Execution MVP', () => {\n  it('should complete full execution lifecycle', async () => {\n    // 1. Create a test issue\n    const issue = await createTestIssue();\n    \n    // 2. Start execution\n    const { executionId } = await POST(`/api/issues/${issue.id}/executions`, {\n      agentType: 'claude-code',\n      prompt: 'List files in current directory'\n    });\n    \n    // 3. Verify running status\n    const status = await GET(`/api/executions/${executionId}`);\n    expect(status.status).toBe('running');\n    \n    // 4. Wait for completion or timeout\n    await waitForStatus(executionId, ['completed', 'failed'], 30000);\n    \n    // 5. Verify logs exist\n    const logs = await readExecutionLogs(executionId);\n    expect(logs.stdout).toBeTruthy();\n    \n    // 6. Verify in database\n    const dbExecution = await db.getExecution(executionId);\n    expect(dbExecution.status).toMatch(/completed|failed/);\n  });\n});\n```\n\n## Dependencies\n\n- [[ISSUE-028]] - Database schema\n- [[ISSUE-029]] - ExecutionManager\n- [[ISSUE-030]] - Process spawning\n- [[ISSUE-031]] - API endpoints\n- [[ISSUE-032]] - Log storage\n\nImplements [[SPEC-001]] Phase 1","status":"open","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:03:20.673Z","created_at":"2025-10-27 00:11:16","updated_at":"2025-10-28 19:03:20","closed_at":null,"parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-034","uuid":"6831a818-45d6-4062-be11-0a4e7c7db779","title":"Implement custom Tiptap extension for entity mention widgets","content":"## Goal\nBuild a custom Tiptap extension that renders `[[ISSUE-ID]]` and `[[SPEC-ID]]` mentions as interactive React components (widgets) in the spec viewer.\n\n## Current Behavior\nEntity mentions in specs and issues are displayed as plain text in the format `[[ENTITY-ID]]`.\n\n## Desired Behavior\nEntity mentions should be rendered as interactive badge widgets that:\n- Display the entity ID with appropriate styling (different colors for issues vs specs)\n- Show an icon indicating the entity type\n- Link to the entity page\n- (Future) Display a run button for executing the entity\n- (Future) Show run status (pending, running, complete)\n- (Future) Display agent messages in an expandable panel\n\n## Technical Approach\nUse Tiptap's custom node extension with React node views:\n\n1. **Create EntityMention extension** (`EntityMention.tsx`)\n   - Define as inline, atomic node\n   - Store `entityId` and `entityType` as attributes\n   - Use `ReactNodeViewRenderer` for custom rendering\n\n2. **Create EntityMentionComponent** (`EntityMentionComponent.tsx`)\n   - React component using `NodeViewWrapper`\n   - Render Badge with appropriate styling\n   - Link to entity page\n   - Placeholder for future interactive features\n\n3. **Parse markdown to detect entity mentions**\n   - Preprocess markdown to convert `[[ENTITY-ID]]` to custom HTML\n   - Configure Tiptap to parse the custom HTML into EntityMention nodes\n\n4. **Add extension to editors**\n   - Update `TiptapEditor.tsx` to include EntityMention extension\n   - Update `TiptapMarkdownViewer.tsx` to include EntityMention extension\n\n5. **Handle markdown export**\n   - Ensure entity mentions convert back to `[[ENTITY-ID]]` format when saving\n\n## Files to Create/Modify\n- Create: `frontend/src/components/specs/extensions/EntityMention.tsx`\n- Create: `frontend/src/components/specs/extensions/EntityMentionComponent.tsx`\n- Modify: `frontend/src/components/specs/TiptapEditor.tsx`\n- Modify: `frontend/src/components/specs/TiptapMarkdownViewer.tsx`\n\n## References\n- Tiptap custom extensions: https://tiptap.dev/docs/editor/extensions/custom-extensions\n- React node views: https://tiptap.dev/docs/editor/extensions/custom-extensions/node-views/react","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.056Z","created_at":"2025-10-27 04:20:34","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-27 04:24:47","parent_id":null,"relationships":[],"tags":[]}
{"id":"ISSUE-035","uuid":"2a63d735-417f-4623-85d0-a796e3e57439","title":"Setup process layer directory structure","content":"Create the directory structure for the Process Layer implementation as defined in [[SPEC-003]].\n\n## Tasks\n- [ ] Create `server/src/execution/` directory\n- [ ] Create `server/src/execution/process/` subdirectory\n- [ ] Create placeholder files:\n  - `types.ts` - Core types and interfaces\n  - `manager.ts` - IProcessManager interface\n  - `simple-manager.ts` - SimpleProcessManager implementation\n  - `utils.ts` - Helper functions (generateId, etc.)\n- [ ] Create `server/src/execution/process/__tests__/` for tests\n- [ ] Add barrel export `index.ts` to export public API\n\n## Acceptance Criteria\n- Directory structure matches spec file structure\n- All placeholder files created with basic TypeScript module structure\n- Imports/exports work correctly","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.052Z","created_at":"2025-10-28 09:04:39","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-28 18:15:09","parent_id":null,"relationships":[],"tags":["infrastructure","setup"]}
{"id":"ISSUE-036","uuid":"35503523-9f1e-43d9-b74d-3873668d10f7","title":"Define core process types in types.ts","content":"Implement all core TypeScript types and interfaces for the Process Layer as defined in [[SPEC-003]].\n\n## Types to Implement\n\n### ManagedProcess\n```typescript\ninterface ManagedProcess {\n  id: string;\n  pid: number;\n  status: ProcessStatus;\n  spawnedAt: Date;\n  lastActivity: Date;\n  exitCode: number | null;\n  signal: string | null;\n  process: ChildProcess;\n  streams: {\n    stdout: Readable;\n    stderr: Readable;\n    stdin: Writable;\n  };\n  metrics: {\n    totalDuration: number;\n    tasksCompleted: number;\n    successRate: number;\n  };\n}\n```\n\n### ProcessStatus\n```typescript\ntype ProcessStatus = \n  | 'spawning'\n  | 'idle'\n  | 'busy'\n  | 'terminating'\n  | 'crashed'\n  | 'completed';\n```\n\n### ProcessConfig\n```typescript\ninterface ProcessConfig {\n  claudePath: string;\n  workDir: string;\n  args: {\n    print: boolean;\n    outputFormat: 'stream-json' | 'json' | 'text';\n    dangerouslySkipPermissions: boolean;\n    permissionMode?: string;\n  };\n  env?: Record<string, string>;\n  timeout?: number;\n  idleTimeout?: number;\n  retry?: {\n    maxAttempts: number;\n    backoffMs: number;\n  };\n}\n```\n\n### ProcessMetrics\n```typescript\ninterface ProcessMetrics {\n  totalSpawned: number;\n  currentlyActive: number;\n  totalCompleted: number;\n  totalFailed: number;\n  averageDuration: number;\n}\n```\n\n### Handler Types\n```typescript\ntype OutputHandler = (data: Buffer, type: 'stdout' | 'stderr') => void;\ntype ErrorHandler = (error: Error) => void;\n```\n\n## Acceptance Criteria\n- All types defined with correct TypeScript syntax\n- Types exported from `types.ts`\n- JSDoc comments added for documentation\n- No TypeScript compilation errors","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.051Z","created_at":"2025-10-28 09:04:40","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-28 18:53:52","parent_id":null,"relationships":[],"tags":["core","types"]}
{"id":"ISSUE-037","uuid":"8652253b-c22a-4a56-b6ff-d1d022a2d76c","title":"Define IProcessManager interface","content":"Implement the IProcessManager interface that defines the contract for all process managers as specified in [[SPEC-003]].\n\n## Interface Methods\n\n```typescript\ninterface IProcessManager {\n  // Process lifecycle\n  acquireProcess(config: ProcessConfig): Promise<ManagedProcess>;\n  releaseProcess(processId: string): Promise<void>;\n  terminateProcess(processId: string, signal?: NodeJS.Signals): Promise<void>;\n  \n  // Process communication\n  sendInput(processId: string, input: string): Promise<void>;\n  onOutput(processId: string, handler: OutputHandler): void;\n  onError(processId: string, handler: ErrorHandler): void;\n  \n  // Monitoring\n  getProcess(processId: string): ManagedProcess | null;\n  getActiveProcesses(): ManagedProcess[];\n  getMetrics(): ProcessMetrics;\n  \n  // Cleanup\n  shutdown(): Promise<void>;\n}\n```\n\n## Tasks\n- [ ] Define interface in `manager.ts`\n- [ ] Add comprehensive JSDoc comments for each method\n- [ ] Import necessary types from `types.ts`\n- [ ] Export interface\n\n## Acceptance Criteria\n- Interface compiles without errors\n- All methods have clear JSDoc documentation\n- Types are correctly imported\n- Interface is exported for use by implementations","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.047Z","created_at":"2025-10-28 09:04:41","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-28 18:54:00","parent_id":null,"relationships":[],"tags":["core","interface"]}
{"id":"ISSUE-038","uuid":"2d075822-7165-4973-bc83-bd95ed0893a8","title":"Implement utility functions (generateId, etc.)","content":"Implement helper utility functions needed by the Process Layer in `utils.ts` as referenced in [[SPEC-003]].\n\n## Functions to Implement\n\n### generateId\nGenerate unique process IDs with a prefix.\n```typescript\nfunction generateId(prefix: string): string\n```\n\nExample: `generateId('process')` → `'process-abc123'`\n\n### Additional Utilities (as needed)\n- Error message formatting\n- Signal name validation\n- Duration formatting\n\n## Tasks\n- [ ] Implement `generateId` function using `nanoid` or similar\n- [ ] Add tests for `generateId` uniqueness\n- [ ] Export all utility functions\n\n## Acceptance Criteria\n- `generateId` produces unique IDs\n- IDs are URL-safe and readable\n- Functions are well-tested\n- All utilities exported","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.043Z","created_at":"2025-10-28 09:04:41","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-28 18:54:05","parent_id":null,"relationships":[],"tags":["core","utils"]}
{"id":"ISSUE-039","uuid":"06916dd4-cfc2-4893-abdf-353a0e17ca61","title":"Implement SimpleProcessManager class skeleton","content":"Create the basic SimpleProcessManager class structure that implements IProcessManager as defined in [[SPEC-003]].\n\n## Class Structure\n\n```typescript\nclass SimpleProcessManager implements IProcessManager {\n  private activeProcesses = new Map<string, ManagedProcess>();\n  private metrics: ProcessMetrics = {\n    totalSpawned: 0,\n    currentlyActive: 0,\n    totalCompleted: 0,\n    totalFailed: 0,\n    averageDuration: 0,\n  };\n\n  constructor(private defaultConfig: Partial<ProcessConfig> = {}) {}\n\n  async acquireProcess(config: ProcessConfig): Promise<ManagedProcess> {\n    throw new Error('Not implemented');\n  }\n\n  async releaseProcess(processId: string): Promise<void> {\n    throw new Error('Not implemented');\n  }\n\n  async terminateProcess(processId: string, signal?: NodeJS.Signals): Promise<void> {\n    throw new Error('Not implemented');\n  }\n\n  async sendInput(processId: string, input: string): Promise<void> {\n    throw new Error('Not implemented');\n  }\n\n  onOutput(processId: string, handler: OutputHandler): void {\n    throw new Error('Not implemented');\n  }\n\n  onError(processId: string, handler: ErrorHandler): void {\n    throw new Error('Not implemented');\n  }\n\n  getProcess(processId: string): ManagedProcess | null {\n    throw new Error('Not implemented');\n  }\n\n  getActiveProcesses(): ManagedProcess[] {\n    throw new Error('Not implemented');\n  }\n\n  getMetrics(): ProcessMetrics {\n    throw new Error('Not implemented');\n  }\n\n  async shutdown(): Promise<void> {\n    throw new Error('Not implemented');\n  }\n}\n```\n\n## Tasks\n- [ ] Create class in `simple-manager.ts`\n- [ ] Implement constructor\n- [ ] Add private fields (activeProcesses, metrics)\n- [ ] Add stub methods for all interface methods\n- [ ] Export class\n\n## Acceptance Criteria\n- Class implements IProcessManager correctly\n- TypeScript compilation succeeds\n- All methods have stubs\n- Class can be instantiated","status":"closed","priority":0,"assignee":null,"archived":1,"archived_at":"2025-10-28T19:15:21.041Z","created_at":"2025-10-28 09:04:42","updated_at":"2025-10-28 19:15:21","closed_at":"2025-10-28 18:54:10","parent_id":null,"relationships":[],"tags":["core","implementation"]}
{"id":"ISSUE-040","uuid":"a52ac3cc-cbdc-4e19-92e9-785caba38c9a","title":"Implement process spawning with child_process","content":"Implement the core process spawning functionality in SimpleProcessManager as defined in [[SPEC-003]].\n\n## Implementation Details\n\n### Methods to Implement\n\n1. **spawnClaudeProcess** (private)\n   - Use Node.js `spawn` from `child_process`\n   - Set stdio to `['pipe', 'pipe', 'pipe']`\n   - Pass working directory and environment\n   - Return ChildProcess instance\n\n2. **buildClaudeArgs** (private)\n   - Build CLI arguments array from ProcessConfig\n   - Handle `--print`, `--output-format`, `--dangerously-skip-permissions`\n   - Handle optional `--permission-mode`\n\n3. **acquireProcess** (public)\n   - Call `spawnClaudeProcess`\n   - Create ManagedProcess object\n   - Validate process spawned (check pid)\n   - Add to activeProcesses map\n   - Update metrics\n   - Return ManagedProcess\n\n## Tasks\n- [ ] Implement `buildClaudeArgs` method\n- [ ] Implement `spawnClaudeProcess` method  \n- [ ] Implement `acquireProcess` method\n- [ ] Handle spawn errors gracefully\n- [ ] Update metrics on spawn\n\n## Acceptance Criteria\n- Process spawns successfully with correct arguments\n- Working directory is set correctly\n- Environment variables are passed\n- Process ID is generated and tracked\n- Metrics are updated\n- Errors are thrown if spawn fails","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-29T08:14:40.960Z","created_at":"2025-10-28 09:04:43","updated_at":"2025-10-29 08:14:40","closed_at":"2025-10-28 19:43:19","parent_id":null,"relationships":[],"tags":["implementation","spawning"]}
{"id":"ISSUE-041","uuid":"4a74fe37-7697-413a-aca3-2a0d722c8634","title":"Implement event handlers for process lifecycle","content":"Implement event handlers for process exit, error, and I/O events as defined in [[SPEC-003]].\n\n## Implementation Details\n\n### setupProcessHandlers (private method)\n\nHandle these events:\n\n1. **exit event**\n   - Clear timeout if set\n   - Set exitCode and signal on ManagedProcess\n   - Set status to 'completed' (code 0) or 'crashed' (code != 0)\n   - Calculate duration\n   - Update global metrics (currentlyActive, totalCompleted, totalFailed)\n   - Schedule cleanup (delete from activeProcesses after 5s delay)\n\n2. **error event**\n   - Clear timeout if set\n   - Set status to 'crashed'\n   - Update metrics (currentlyActive--, totalFailed++)\n\n3. **stdout/stderr data events**\n   - Update lastActivity timestamp\n\n### Timeout Handling\n- Set timeout from config if provided\n- Clear timeout on process exit/error\n- Terminate process (SIGTERM) on timeout\n\n## Tasks\n- [ ] Implement `setupProcessHandlers` method\n- [ ] Add exit event handler\n- [ ] Add error event handler\n- [ ] Add I/O data handlers for activity tracking\n- [ ] Add timeout management\n- [ ] Call `setupProcessHandlers` from `acquireProcess`\n\n## Acceptance Criteria\n- Exit events update metrics correctly\n- Error events are handled gracefully\n- Timeouts terminate processes\n- Last activity is tracked on I/O\n- Cleanup happens after delay","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-29T08:14:40.958Z","created_at":"2025-10-28 09:04:43","updated_at":"2025-10-29 08:14:40","closed_at":"2025-10-28 20:01:26","parent_id":null,"relationships":[],"tags":["events","implementation"]}
{"id":"ISSUE-042","uuid":"45abf348-f296-4636-b62d-25ecd15f68e6","title":"Implement process I/O communication methods","content":"Implement methods for sending input to processes and receiving output as defined in [[SPEC-003]].\n\n## Methods to Implement\n\n### sendInput\n```typescript\nasync sendInput(processId: string, input: string): Promise<void> {\n  const managed = this.activeProcesses.get(processId);\n  if (!managed) {\n    throw new Error(`Process ${processId} not found`);\n  }\n\n  return new Promise((resolve, reject) => {\n    managed.streams.stdin.write(input, (error) => {\n      if (error) reject(error);\n      else resolve();\n    });\n  });\n}\n```\n\n### onOutput\n```typescript\nonOutput(processId: string, handler: OutputHandler): void {\n  const managed = this.activeProcesses.get(processId);\n  if (!managed) return;\n\n  managed.streams.stdout.on('data', (data: Buffer) => {\n    handler(data, 'stdout');\n  });\n\n  managed.streams.stderr.on('data', (data: Buffer) => {\n    handler(data, 'stderr');\n  });\n}\n```\n\n### onError\n```typescript\nonError(processId: string, handler: ErrorHandler): void {\n  const managed = this.activeProcesses.get(processId);\n  if (!managed) return;\n\n  managed.process.on('error', (error: Error) => {\n    handler(error);\n  });\n}\n```\n\n## Tasks\n- [ ] Implement `sendInput` method\n- [ ] Implement `onOutput` method\n- [ ] Implement `onError` method\n- [ ] Handle process not found errors\n- [ ] Handle stream write errors\n\n## Acceptance Criteria\n- sendInput writes to process stdin\n- onOutput registers handlers for stdout/stderr\n- onError registers error handler\n- Errors are properly propagated\n- Methods handle missing processes gracefully","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-29T08:14:40.952Z","created_at":"2025-10-28 09:04:44","updated_at":"2025-10-29 08:14:40","closed_at":"2025-10-28 22:03:14","parent_id":null,"relationships":[],"tags":["implementation","io"]}
{"id":"ISSUE-043","uuid":"15a21f28-9b47-4617-a2a6-e85be1cd68d4","title":"Implement graceful process termination","content":"Implement graceful process termination with SIGTERM → SIGKILL fallback as defined in [[SPEC-003]].\n\n## Implementation Details\n\n### terminateProcess\n```typescript\nasync terminateProcess(\n  processId: string, \n  signal: NodeJS.Signals = 'SIGTERM'\n): Promise<void> {\n  const managed = this.activeProcesses.get(processId);\n  if (!managed) return;\n\n  managed.status = 'terminating';\n\n  // Try graceful shutdown first\n  managed.process.kill(signal);\n\n  // Wait for graceful shutdown\n  await new Promise(resolve => setTimeout(resolve, 2000));\n\n  // Force kill if still running\n  if (!managed.process.killed && managed.exitCode === null) {\n    managed.process.kill('SIGKILL');\n  }\n}\n```\n\n### releaseProcess\n```typescript\nasync releaseProcess(processId: string): Promise<void> {\n  await this.terminateProcess(processId);\n}\n```\n\n### shutdown\n```typescript\nasync shutdown(): Promise<void> {\n  const processes = Array.from(this.activeProcesses.keys());\n  await Promise.all(\n    processes.map(id => this.terminateProcess(id, 'SIGTERM'))\n  );\n}\n```\n\n## Tasks\n- [ ] Implement `terminateProcess` method\n- [ ] Implement graceful shutdown with 2s wait\n- [ ] Implement force kill (SIGKILL) fallback\n- [ ] Implement `releaseProcess` method\n- [ ] Implement `shutdown` method to terminate all processes\n\n## Acceptance Criteria\n- SIGTERM sent first\n- 2-second grace period before SIGKILL\n- Status updated to 'terminating'\n- All processes terminated on shutdown\n- Methods are idempotent (safe to call multiple times)","status":"closed","priority":1,"assignee":null,"archived":1,"archived_at":"2025-10-29T08:14:40.956Z","created_at":"2025-10-28 09:04:45","updated_at":"2025-10-29 08:14:40","closed_at":"2025-10-28 22:19:48","parent_id":null,"relationships":[],"tags":["implementation","termination"]}
{"id":"ISSUE-044","uuid":"74989b71-9314-4a3a-a6fc-2a6dbf76c3d1","title":"Implement monitoring and metrics methods","content":"Implement process monitoring and metrics retrieval methods as defined in [[SPEC-003]].\n\n## Methods to Implement\n\n### getProcess\n```typescript\ngetProcess(processId: string): ManagedProcess | null {\n  return this.activeProcesses.get(processId) || null;\n}\n```\n\n### getActiveProcesses\n```typescript\ngetActiveProcesses(): ManagedProcess[] {\n  return Array.from(this.activeProcesses.values());\n}\n```\n\n### getMetrics\n```typescript\ngetMetrics(): ProcessMetrics {\n  return { ...this.metrics };\n}\n```\n\n## Tasks\n- [ ] Implement `getProcess` method\n- [ ] Implement `getActiveProcesses` method\n- [ ] Implement `getMetrics` method\n- [ ] Ensure metrics object is cloned (not mutated)\n\n## Acceptance Criteria\n- getProcess returns process or null\n- getActiveProcesses returns array of all active processes\n- getMetrics returns copy of metrics (not reference)\n- All methods return correct data","status":"closed","priority":2,"assignee":null,"archived":1,"archived_at":"2025-10-29T08:14:40.947Z","created_at":"2025-10-28 09:04:45","updated_at":"2025-10-29 08:14:40","closed_at":"2025-10-28 23:30:20","parent_id":null,"relationships":[],"tags":["implementation","monitoring"]}
{"id":"ISSUE-045","uuid":"3dc7b78c-5427-4d4b-9cc5-289841cdb367","title":"Write unit tests for process spawning","content":"Write comprehensive unit tests for process spawning functionality as outlined in [[SPEC-003]].\n\n## Test Cases\n\n### Process Spawning\n- [ ] Spawns process with correct arguments\n- [ ] Sets working directory correctly\n- [ ] Passes environment variables\n- [ ] Generates unique process ID\n- [ ] Returns ManagedProcess with correct structure\n- [ ] Throws error if spawn fails\n- [ ] Updates metrics on spawn\n\n### Argument Building\n- [ ] Includes `--print` when configured\n- [ ] Includes `--output-format` with correct value\n- [ ] Includes `--dangerously-skip-permissions` when configured\n- [ ] Includes `--permission-mode` when provided\n- [ ] Builds correct argument array\n\n## Test Framework\n- Use Vitest or Jest\n- Mock `child_process.spawn` for controlled testing\n- Test both success and failure paths\n\n## Acceptance Criteria\n- All test cases pass\n- Code coverage > 80% for spawning methods\n- Tests are isolated and don't spawn real processes\n- Tests run quickly (< 1s)","status":"closed","priority":2,"assignee":null,"archived":1,"archived_at":"2025-10-29T08:14:40.954Z","created_at":"2025-10-28 09:04:46","updated_at":"2025-10-29 08:14:40","closed_at":"2025-10-28 23:35:36","parent_id":null,"relationships":[],"tags":["testing","unit-tests"]}
{"id":"ISSUE-046","uuid":"4c81dd30-40ab-4a2b-a2f4-261703f9fd26","title":"Write unit tests for process lifecycle management","content":"Write unit tests for process lifecycle events and state management as outlined in [[SPEC-003]].\n\n## Test Cases\n\n### Lifecycle Management\n- [ ] Tracks process status correctly through lifecycle\n- [ ] Updates status on exit (completed vs crashed)\n- [ ] Updates metrics on successful exit\n- [ ] Updates metrics on failed exit\n- [ ] Cleans up processes after delay\n- [ ] Handles spawn errors\n\n### Event Handlers\n- [ ] Exit event handler updates state\n- [ ] Error event handler updates state\n- [ ] Timeout triggers termination\n- [ ] I/O updates lastActivity timestamp\n\n### State Transitions\n- [ ] spawning → busy → completed\n- [ ] spawning → busy → crashed\n- [ ] busy → terminating → completed\n- [ ] busy → terminating → (force killed)\n\n## Acceptance Criteria\n- All test cases pass\n- Code coverage > 80% for lifecycle methods\n- Tests verify state transitions\n- Async behavior is properly tested","status":"closed","priority":2,"assignee":null,"archived":1,"archived_at":"2025-10-29T08:14:40.953Z","created_at":"2025-10-28 09:04:47","updated_at":"2025-10-29 08:14:40","closed_at":"2025-10-28 23:38:38","parent_id":null,"relationships":[],"tags":["testing","unit-tests"]}
{"id":"ISSUE-047","uuid":"b0097068-c379-4619-bea6-8914894318d8","title":"Write unit tests for I/O handling","content":"Write unit tests for process I/O communication methods as outlined in [[SPEC-003]].\n\n## Test Cases\n\n### sendInput\n- [ ] Writes input to process stdin\n- [ ] Returns promise that resolves on success\n- [ ] Rejects promise on write error\n- [ ] Throws error if process not found\n- [ ] Handles multiple writes\n\n### onOutput\n- [ ] Registers stdout handler\n- [ ] Registers stderr handler\n- [ ] Handler receives correct data\n- [ ] Handler receives correct type ('stdout' or 'stderr')\n- [ ] Returns early if process not found\n- [ ] Supports multiple handlers\n\n### onError\n- [ ] Registers error handler\n- [ ] Handler receives error\n- [ ] Returns early if process not found\n\n## Acceptance Criteria\n- All test cases pass\n- Code coverage > 80% for I/O methods\n- Tests use mocked streams\n- Error cases are tested","status":"closed","priority":2,"assignee":null,"archived":1,"archived_at":"2025-10-29T08:14:40.945Z","created_at":"2025-10-28 09:04:47","updated_at":"2025-10-29 08:14:40","closed_at":"2025-10-28 23:53:20","parent_id":null,"relationships":[],"tags":["testing","unit-tests"]}
{"id":"ISSUE-048","uuid":"40237a96-1990-44b4-8c9a-3518c14808a0","title":"Write unit tests for process termination","content":"Write unit tests for process termination methods as outlined in [[SPEC-003]].\n\n## Test Cases\n\n### terminateProcess\n- [ ] Sends SIGTERM by default\n- [ ] Sends custom signal if provided\n- [ ] Sets status to 'terminating'\n- [ ] Waits 2 seconds for graceful shutdown\n- [ ] Sends SIGKILL if process still running after grace period\n- [ ] Returns early if process not found\n- [ ] Is idempotent (safe to call multiple times)\n\n### releaseProcess\n- [ ] Calls terminateProcess\n- [ ] Passes through correct process ID\n\n### shutdown\n- [ ] Terminates all active processes\n- [ ] Uses SIGTERM signal\n- [ ] Waits for all processes to terminate\n- [ ] Handles empty process list\n\n## Acceptance Criteria\n- All test cases pass\n- Code coverage > 80% for termination methods\n- Timing is tested (2s grace period)\n- Parallel termination tested for shutdown","status":"closed","priority":2,"assignee":null,"archived":1,"archived_at":"2025-10-29T08:14:40.943Z","created_at":"2025-10-28 09:04:48","updated_at":"2025-10-29 08:14:40","closed_at":"2025-10-28 23:55:42","parent_id":null,"relationships":[],"tags":["testing","unit-tests"]}
{"id":"ISSUE-049","uuid":"cc1fd76b-e38d-48c5-9c1f-f8f766fad724","title":"Write integration tests for end-to-end process execution","content":"Write integration tests that test the full process lifecycle with real Claude Code processes as outlined in [[SPEC-003]].\n\n## Test Scenarios\n\n### End-to-End Execution\n- [ ] Spawn → send prompt → receive output → terminate\n  - Spawn process successfully\n  - Send input via stdin\n  - Receive output via stdout\n  - Terminate cleanly\n  - Verify metrics updated\n\n### Multiple Concurrent Processes\n- [ ] Spawn multiple processes simultaneously\n- [ ] Each process executes independently\n- [ ] Metrics track all processes\n- [ ] All processes clean up properly\n\n### Process Crash Recovery\n- [ ] Process exits with non-zero code\n- [ ] Status updates to 'crashed'\n- [ ] Metrics reflect failure\n- [ ] Cleanup happens automatically\n\n### Error Scenarios\n- [ ] Invalid Claude path\n  - Spawn fails with clear error\n  - Metrics not incremented\n  \n- [ ] Process spawn failure\n  - Error event fired\n  - Process marked as crashed\n  \n- [ ] Timeout handling\n  - Process exceeds timeout\n  - SIGTERM sent automatically\n  - SIGKILL sent if needed\n\n## Test Setup\n- Use real `claude` CLI (or mock if not available)\n- Set reasonable timeouts for tests\n- Clean up all processes after tests\n- Use temporary directories for working dirs\n\n## Acceptance Criteria\n- All integration tests pass\n- Tests use real child processes (not mocks)\n- Tests complete in reasonable time (< 30s)\n- No processes left running after tests\n- Tests are reliable and don't flake","status":"closed","priority":3,"assignee":null,"archived":1,"archived_at":"2025-10-29T08:14:40.935Z","created_at":"2025-10-28 09:04:49","updated_at":"2025-10-29 08:14:40","closed_at":"2025-10-29 00:20:24","parent_id":null,"relationships":[],"tags":["integration-tests","testing"]}
{"id":"ISSUE-050","uuid":"21a4913e-2865-4cd1-ba8d-12a8a6dca727","title":"Define Engine Layer core types and interfaces","content":"## Overview\nCreate foundational types and interfaces for the Engine Layer as specified in [[SPEC-004]].\n\n## Tasks\n- [ ] Create `server/src/execution/engine/types.ts`\n  - `ExecutionTask` - unit of work for Claude Code agents\n  - `ExecutionResult` - outcome of task execution\n  - `EngineMetrics` - performance statistics\n  - `TaskStatus` - task state tracking\n  - Helper types: `TaskCompleteHandler`, `TaskFailedHandler`, `EngineConfig`, `RunningTask`, `TaskResolver`\n\n- [ ] Create `server/src/execution/engine/engine.ts`\n  - `IExecutionEngine` interface definition\n  - Method signatures for task submission, control, execution, monitoring, lifecycle\n\n## Acceptance Criteria\n- All types match SPEC-004 specification\n- TypeScript compiles without errors\n- Types exported properly for use by implementations\n- JSDoc comments for public API\n\n## Related\nImplements [[SPEC-004]] - Engine Layer foundation","status":"closed","priority":0,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:57:16","updated_at":"2025-10-29 08:15:15","closed_at":"2025-10-29 08:15:15","parent_id":null,"relationships":[{"from":"ISSUE-050","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["engine","foundation","layer-2","types"]}
{"id":"ISSUE-051","uuid":"4793baaf-9717-437d-addd-82a7d213dbfc","title":"Implement task queue with FIFO ordering","content":"## Overview\nImplement the task queueing mechanism for SimpleExecutionEngine as part of [[SPEC-004]].\n\n## Tasks\n- [ ] Create internal queue data structure (array-based FIFO)\n- [ ] Implement `submitTask()` - add task to queue\n- [ ] Implement `submitTasks()` - batch submission\n- [ ] Implement queue processing logic `processQueue()`\n- [ ] Add queue position tracking for status queries\n- [ ] Handle queue metrics (queuedTasks count)\n\n## Implementation Details\n- Use simple array with push/shift for FIFO\n- Check capacity before dequeuing tasks\n- Update metrics when tasks enter/leave queue\n- Support re-queueing for dependency waits and retries\n\n## Acceptance Criteria\n- Tasks execute in submission order (FIFO)\n- Queue respects concurrency limits\n- Metrics accurately reflect queue size\n- Re-queueing works for dependencies and retries\n\n## Dependencies\nRequires [[ISSUE-050]] (core types)\n\n## Related\nImplements [[SPEC-004]] task queueing","status":"closed","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:57:31","updated_at":"2025-10-29 08:25:20","closed_at":"2025-10-29 08:25:20","parent_id":null,"relationships":[{"from":"ISSUE-051","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["engine","layer-2","queue"]}
{"id":"ISSUE-052","uuid":"97ee5220-151f-4536-a449-0f3d3066a737","title":"Implement concurrency control and capacity management","content":"## Overview\nImplement concurrency limits and capacity tracking for SimpleExecutionEngine per [[SPEC-004]].\n\n## Tasks\n- [ ] Track running tasks with Map<taskId, RunningTask>\n- [ ] Enforce maxConcurrent limit in processQueue()\n- [ ] Update capacity metrics (currentlyRunning, availableSlots)\n- [ ] Prevent queue processing when at capacity\n- [ ] Release capacity when tasks complete\n- [ ] Handle capacity in shutdown scenario\n\n## Implementation Details\n- Default maxConcurrent: 3 (configurable)\n- Check `runningTasks.size < maxConcurrent` before starting tasks\n- Decrement on completion/failure/cancellation\n- Trigger processQueue() when slots become available\n\n## Acceptance Criteria\n- Never exceeds maxConcurrent simultaneous tasks\n- Accurately tracks available slots\n- Starts queued tasks immediately when capacity available\n- Handles concurrent completion correctly\n\n## Dependencies\nRequires [[ISSUE-051]] (task queue)\n\n## Related\nImplements [[SPEC-004]] capacity control","status":"closed","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:57:42","updated_at":"2025-10-29 08:44:04","closed_at":"2025-10-29 08:44:04","parent_id":null,"relationships":[{"from":"ISSUE-052","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["concurrency","engine","layer-2"]}
{"id":"ISSUE-053","uuid":"0d5776d9-cfab-4e15-85fd-94795a914b4c","title":"Implement task execution and Process Layer integration","content":"## Overview\nImplement core task execution logic that integrates with the Process Layer from [[SPEC-003]].\n\n## Tasks\n- [ ] Implement `executeTask()` method\n- [ ] Acquire process from ProcessManager\n- [ ] Send prompt via `processManager.sendInput()`\n- [ ] Collect stdout/stderr output with `onOutput()`\n- [ ] Wait for process exit\n- [ ] Build ExecutionResult from process output\n- [ ] Parse stream-json metadata (tools used, files changed, tokens)\n- [ ] Release process after completion\n- [ ] Handle execution errors and process crashes\n\n## Implementation Details\n- Use `buildClaudeConfig()` helper for ProcessConfig\n- Set up output handlers before sending input\n- Implement `waitForProcessExit()` helper with polling\n- Extract metadata from stream-json lines\n- Track execution timing (startedAt, completedAt, duration)\n\n## Acceptance Criteria\n- Successfully spawns and manages Claude Code processes\n- Captures all output and errors\n- Correctly parses stream-json metadata\n- Handles process failures gracefully\n- Cleans up processes properly\n\n## Dependencies\nRequires [[ISSUE-052]] (concurrency control)\nDepends on [[SPEC-003]] Process Layer\n\n## Related\nImplements [[SPEC-004]] core execution","status":"closed","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:57:57","updated_at":"2025-10-29 09:37:02","closed_at":"2025-10-29 09:22:53","parent_id":null,"relationships":[{"from":"ISSUE-053","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["engine","execution","integration","layer-2"]}
{"id":"ISSUE-054","uuid":"abd5a94b-87ca-454d-b119-731adbcffdf9","title":"Implement task dependency resolution","content":"## Overview\nImplement dependency checking and ordering for tasks as specified in [[SPEC-004]].\n\n## Tasks\n- [ ] Implement `areDependenciesMet()` helper\n- [ ] Check all dependencies in completedResults\n- [ ] Verify dependencies completed successfully\n- [ ] Re-queue tasks with unmet dependencies\n- [ ] Prevent infinite loops from circular dependencies\n- [ ] Handle failed dependency scenarios\n\n## Implementation Details\n- Check task.dependencies array before execution\n- Look up each dependency ID in completedResults map\n- Require `result.success === true` for dependency\n- Re-queue at end if dependencies not met\n- Break queue processing loop to prevent infinite re-queuing\n\n## Acceptance Criteria\n- Tasks wait for dependencies before executing\n- Failed dependencies prevent dependent tasks from running\n- No infinite loops from circular or missing dependencies\n- Correct execution order maintained\n\n## Dependencies\nRequires [[ISSUE-053]] (task execution)\n\n## Related\nImplements [[SPEC-004]] dependency resolution","status":"closed","priority":2,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:58:07","updated_at":"2025-10-29 10:21:38","closed_at":"2025-10-29 10:21:38","parent_id":null,"relationships":[{"from":"ISSUE-054","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["dependencies","engine","layer-2"]}
{"id":"ISSUE-055","uuid":"2b7a0e1f-cc08-4e58-a1b3-f9a1b2aa4727","title":"Implement task retry logic","content":"## Overview\nImplement automatic retry for failed tasks as specified in [[SPEC-004]].\n\n## Tasks\n- [ ] Check `task.config.maxRetries` setting\n- [ ] Track attempt count in RunningTask\n- [ ] Re-queue failed task if retries remaining\n- [ ] Use priority re-queue (unshift) for retries\n- [ ] Stop retrying after maxRetries reached\n- [ ] Emit failure event after final retry fails\n\n## Implementation Details\n- Default: no retries (maxRetries undefined)\n- Increment `running.attempt` on each retry\n- Re-queue at front: `taskQueue.unshift(task)`\n- Only retry on failure, not on cancellation\n- Track retry count in task metadata\n\n## Acceptance Criteria\n- Tasks retry up to maxRetries times\n- Retries happen immediately (priority)\n- No retries if maxRetries not configured\n- Final failure emits task failed event\n- Retry count visible in metrics/logs\n\n## Dependencies\nRequires [[ISSUE-053]] (task execution)\n\n## Related\nImplements [[SPEC-004]] retry logic","status":"closed","priority":2,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:58:18","updated_at":"2025-10-29 10:32:44","closed_at":"2025-10-29 10:32:44","parent_id":null,"relationships":[{"from":"ISSUE-055","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["engine","layer-2","resilience","retry"]}
{"id":"ISSUE-056","uuid":"a1f67530-d2a5-42f1-b616-aba3840d0b42","title":"Implement event emission and handlers","content":"## Overview\nImplement event system for task completion and failure as specified in [[SPEC-004]].\n\n## Tasks\n- [ ] Add handler arrays (completeHandlers, failedHandlers)\n- [ ] Implement `onTaskComplete()` - register completion handlers\n- [ ] Implement `onTaskFailed()` - register failure handlers\n- [ ] Emit events in `handleTaskSuccess()`\n- [ ] Emit events in `handleTaskFailure()`\n- [ ] Ensure all handlers are called for each event\n\n## Implementation Details\n- Store handlers in arrays: `TaskCompleteHandler[]`, `TaskFailedHandler[]`\n- Call all registered handlers when events occur\n- Pass complete ExecutionResult for success events\n- Pass taskId and Error for failure events\n- Don't block execution on handler errors\n\n## Acceptance Criteria\n- Multiple handlers can be registered\n- All handlers called on each event\n- Handlers receive correct data\n- Handler errors don't crash engine\n- Events fire for all completion paths (success, failure, retry exhaustion)\n\n## Dependencies\nRequires [[ISSUE-053]] (task execution)\n\n## Related\nImplements [[SPEC-004]] event emission","status":"closed","priority":2,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:58:33","updated_at":"2025-10-29 10:45:03","closed_at":"2025-10-29 10:45:03","parent_id":null,"relationships":[{"from":"ISSUE-056","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["engine","events","layer-2","observability"]}
{"id":"ISSUE-057","uuid":"c6d97642-9885-4e85-bbe4-9435aa49d686","title":"Implement task monitoring and status queries","content":"## Overview\nImplement methods for monitoring task status and progress as specified in [[SPEC-004]].\n\n## Tasks\n- [ ] Implement `getTaskStatus()` - query current task state\n- [ ] Return queued status with position\n- [ ] Return running status with process ID and start time\n- [ ] Return completed status with full result\n- [ ] Return failed/cancelled status as appropriate\n- [ ] Return null for unknown task IDs\n\n## Implementation Details\n- Check completedResults map first\n- Check runningTasks map second\n- Search taskQueue array for position\n- Return discriminated union TaskStatus type\n- Include relevant metadata for each state\n\n## Acceptance Criteria\n- Accurate status for all task states\n- Correct queue position calculation\n- Returns null for non-existent tasks\n- Type-safe discriminated unions\n- Fast lookups (no full array scans except queue)\n\n## Dependencies\nRequires [[ISSUE-051]] (task queue)\n\n## Related\nImplements [[SPEC-004]] monitoring","status":"open","priority":2,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:58:46","updated_at":"2025-10-29 07:58:46","closed_at":null,"parent_id":null,"relationships":[{"from":"ISSUE-057","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["engine","layer-2","monitoring","observability"]}
{"id":"ISSUE-058","uuid":"679fa63b-dab5-4c7f-94e6-8e8723cad918","title":"Implement metrics tracking and calculation","content":"## Overview\nImplement comprehensive metrics tracking for the Engine Layer as specified in [[SPEC-004]].\n\n## Tasks\n- [ ] Initialize EngineMetrics structure\n- [ ] Implement `getMetrics()` - return copy of current metrics\n- [ ] Update metrics on task submission (queuedTasks++)\n- [ ] Update metrics on task start (currentlyRunning++, availableSlots--)\n- [ ] Update metrics on completion (completedTasks++, update averages)\n- [ ] Update metrics on failure (failedTasks++)\n- [ ] Calculate rolling averageDuration\n- [ ] Calculate successRate ratio\n- [ ] Calculate throughput (tasks/minute)\n\n## Implementation Details\n- Return defensive copy from getMetrics()\n- Use running averages: `(avg * (n-1) + new) / n`\n- Track totalProcessesSpawned from ProcessManager\n- Update activeProcesses count\n- Calculate throughput over time window\n\n## Acceptance Criteria\n- All metrics accurate and up-to-date\n- Averages calculated correctly\n- Returns defensive copy (immutable)\n- Metrics reflect real-time state\n- No race conditions in updates\n\n## Dependencies\nRequires [[ISSUE-053]] (task execution)\n\n## Related\nImplements [[SPEC-004]] metrics","status":"open","priority":2,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:58:58","updated_at":"2025-10-29 07:58:58","closed_at":null,"parent_id":null,"relationships":[{"from":"ISSUE-058","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["engine","layer-2","metrics","observability"]}
{"id":"ISSUE-059","uuid":"fdb2b87a-8e24-4a41-a617-ad2231ad76f0","title":"Implement task cancellation and cleanup","content":"## Overview\nImplement task cancellation and cleanup logic as specified in [[SPEC-004]].\n\n## Tasks\n- [ ] Implement `cancelTask()` method\n- [ ] Remove task from queue if still queued\n- [ ] Terminate running process if task executing\n- [ ] Update metrics on cancellation\n- [ ] Clean up running task tracking\n- [ ] Handle cancellation of unknown task IDs gracefully\n\n## Implementation Details\n- Search queue and remove if found\n- Get running task from runningTasks map\n- Call `processManager.terminateProcess()` for running tasks\n- Decrement appropriate metric counters\n- Don't throw errors for non-existent tasks\n- Release capacity slot on cancellation\n\n## Acceptance Criteria\n- Queued tasks removed without execution\n- Running tasks terminated cleanly\n- Metrics updated correctly\n- Capacity released properly\n- Idempotent (safe to call multiple times)\n- Next queued task starts after cancellation\n\n## Dependencies\nRequires [[ISSUE-053]] (task execution)\n\n## Related\nImplements [[SPEC-004]] task control","status":"open","priority":2,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:59:09","updated_at":"2025-10-29 07:59:09","closed_at":null,"parent_id":null,"relationships":[{"from":"ISSUE-059","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["cancellation","engine","layer-2"]}
{"id":"ISSUE-060","uuid":"6cb8aabd-63a0-4182-be5f-b81d0a9b4e41","title":"Implement async task waiting and promises","content":"## Overview\nImplement promise-based waiting for task completion as specified in [[SPEC-004]].\n\n## Tasks\n- [ ] Add taskResolvers map for promise management\n- [ ] Implement `waitForTask()` - return promise that resolves with result\n- [ ] Implement `waitForTasks()` - wait for multiple tasks\n- [ ] Resolve promises in handleTaskSuccess()\n- [ ] Reject promises in handleTaskFailure()\n- [ ] Clean up resolvers after resolution\n- [ ] Handle already-completed tasks\n\n## Implementation Details\n- Store resolve/reject callbacks in taskResolvers Map\n- Check completedResults first (immediate return)\n- Create new promise and store resolver\n- Call resolve() with ExecutionResult on success\n- Call reject() with Error on failure\n- Delete resolver after resolution to prevent memory leak\n- Use Promise.all() for multiple task waiting\n\n## Acceptance Criteria\n- waitForTask() resolves when task completes\n- Already-completed tasks return immediately\n- Promises rejected on failure\n- No memory leaks from unreleased resolvers\n- waitForTasks() waits for all tasks\n- Handles concurrent waiters correctly\n\n## Dependencies\nRequires [[ISSUE-053]] (task execution)\n\n## Related\nImplements [[SPEC-004]] task waiting","status":"open","priority":2,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:59:20","updated_at":"2025-10-29 07:59:20","closed_at":null,"parent_id":null,"relationships":[{"from":"ISSUE-060","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["async","engine","layer-2","promises"]}
{"id":"ISSUE-061","uuid":"daefc7d0-5380-49cf-806c-edd5e71e6e0d","title":"Implement engine shutdown and cleanup","content":"## Overview\nImplement graceful shutdown for SimpleExecutionEngine as specified in [[SPEC-004]].\n\n## Tasks\n- [ ] Implement `shutdown()` method\n- [ ] Clear task queue (stop accepting new tasks)\n- [ ] Cancel all running tasks\n- [ ] Call processManager.shutdown()\n- [ ] Clean up all internal state\n- [ ] Wait for or force-terminate active work\n\n## Implementation Details\n- Set queue to empty array\n- Iterate through runningTasks and cancel each\n- Delegate to processManager for process cleanup\n- Clear all maps (runningTasks, taskResolvers, completedResults)\n- Clear event handler arrays\n- Idempotent (safe to call multiple times)\n\n## Acceptance Criteria\n- No new tasks accepted after shutdown\n- All running tasks cancelled\n- Process manager shut down cleanly\n- All resources released\n- Shutdown completes within reasonable time\n- Safe to call multiple times\n\n## Dependencies\nRequires [[ISSUE-059]] (task cancellation)\n\n## Related\nImplements [[SPEC-004]] lifecycle management","status":"open","priority":2,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:59:30","updated_at":"2025-10-29 07:59:30","closed_at":null,"parent_id":null,"relationships":[{"from":"ISSUE-061","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["engine","layer-2","lifecycle","shutdown"]}
{"id":"ISSUE-062","uuid":"5a94de64-9549-4bad-824d-6dc4530f667e","title":"Write unit tests for Engine Layer components","content":"## Overview\nWrite comprehensive unit tests for SimpleExecutionEngine as specified in [[SPEC-004]].\n\n## Test Coverage\n- [ ] Task queueing - FIFO ordering, queue metrics\n- [ ] Concurrency control - maxConcurrent limits, capacity tracking\n- [ ] Dependency resolution - wait for dependencies, handle failures\n- [ ] Retry logic - retry counts, maxRetries enforcement\n- [ ] Event emission - handlers called, correct data passed\n- [ ] Status queries - all states, queue positions\n- [ ] Metrics - calculations, accuracy, immutability\n- [ ] Cancellation - queue removal, process termination\n- [ ] Promise resolution - waitForTask, already-completed\n- [ ] Shutdown - cleanup, idempotency\n\n## Test Structure\n```\nserver/src/execution/engine/tests/unit/\n├── simple-engine.test.ts    # Core engine tests\n├── queue.test.ts            # Queue behavior\n├── concurrency.test.ts      # Capacity management\n├── dependencies.test.ts     # Dependency resolution\n├── retry.test.ts            # Retry logic\n├── events.test.ts           # Event emission\n├── monitoring.test.ts       # Status and metrics\n└── lifecycle.test.ts        # Shutdown\n```\n\n## Acceptance Criteria\n- All major code paths covered\n- Mock ProcessManager for isolation\n- Test both success and failure scenarios\n- Verify metrics accuracy\n- Test concurrent operations\n- All tests pass\n\n## Dependencies\nRequires [[ISSUE-050]] through [[ISSUE-061]] (implementation)\n\n## Related\nTesting for [[SPEC-004]]","status":"open","priority":3,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:59:43","updated_at":"2025-10-29 07:59:43","closed_at":null,"parent_id":null,"relationships":[{"from":"ISSUE-062","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["engine","layer-2","testing","unit-tests"]}
{"id":"ISSUE-063","uuid":"975de8c7-baec-479a-b057-4a53be964c39","title":"Write integration tests for Engine Layer with Process Layer","content":"## Overview\nWrite end-to-end integration tests using real ProcessManager as specified in [[SPEC-004]].\n\n## Test Coverage\n- [ ] End-to-end task execution - submit → queue → execute → complete\n- [ ] Multiple concurrent tasks - verify parallel execution\n- [ ] Task dependencies - ensure correct ordering\n- [ ] Failed task handling - capture errors properly\n- [ ] Task cancellation during execution\n- [ ] Stream-json metadata parsing\n- [ ] Retry on failure\n- [ ] Metrics accuracy over time\n- [ ] Shutdown with active tasks\n- [ ] Real Claude Code process integration (optional, requires Claude)\n\n## Test Structure\n```\nserver/src/execution/engine/tests/integration/\n└── end-to-end.test.ts    # Full stack integration\n```\n\n## Implementation Notes\n- Use real SimpleProcessManager (not mocked)\n- May use mock executables (node -e) instead of Claude\n- Test realistic scenarios\n- Verify actual process spawning and cleanup\n- Check metrics reflect reality\n\n## Acceptance Criteria\n- Complete lifecycle tested with real processes\n- Concurrent execution verified\n- Dependencies work correctly\n- Metrics match actual behavior\n- All tests pass\n- No process leaks\n\n## Dependencies\nRequires [[ISSUE-062]] (unit tests)\nDepends on [[SPEC-003]] Process Layer implementation\n\n## Related\nIntegration testing for [[SPEC-004]]","status":"open","priority":3,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 07:59:56","updated_at":"2025-10-29 07:59:56","closed_at":null,"parent_id":null,"relationships":[{"from":"ISSUE-063","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["engine","integration-tests","layer-2","testing"]}
{"id":"ISSUE-065","uuid":"692a6821-da97-4cc5-b080-e60a404f5002","title":"Implement SimpleExecutionEngine class","content":"## Overview\nCreate the main SimpleExecutionEngine implementation that brings together all Engine Layer components per [[SPEC-004]].\n\n## Tasks\n- [ ] Create `server/src/execution/engine/simple-engine.ts`\n- [ ] Implement SimpleExecutionEngine class\n- [ ] Integrate all component implementations:\n  - Task queue management\n  - Concurrency control\n  - Task execution with Process Layer\n  - Dependency resolution\n  - Retry logic\n  - Event emission\n  - Monitoring and status\n  - Metrics tracking\n  - Task cancellation\n  - Promise-based waiting\n  - Shutdown and cleanup\n- [ ] Add EngineConfig interface\n- [ ] Export class and types\n\n## Integration Points\n- Uses IProcessManager from [[SPEC-003]]\n- Implements IExecutionEngine interface\n- Delegates to ProcessManager for process operations\n- Uses buildClaudeConfig for ProcessConfig creation\n\n## Acceptance Criteria\n- All IExecutionEngine methods implemented\n- Successfully integrates with ProcessManager\n- Passes all unit tests from [[ISSUE-062]]\n- Passes all integration tests from [[ISSUE-063]]\n- Well-structured, maintainable code\n- Follows \"simple first\" design principle\n\n## Dependencies\nRequires all component issues [[ISSUE-050]] through [[ISSUE-061]]\n\n## Related\nMain implementation for [[SPEC-004]]","status":"closed","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 08:00:19","updated_at":"2025-10-29 10:42:38","closed_at":"2025-10-29 10:42:38","parent_id":null,"relationships":[{"from":"ISSUE-065","from_type":"issue","to":"SPEC-004","to_type":"spec","type":"implements"}],"tags":["core","engine","implementation","layer-2"]}
{"id":"ISSUE-066","uuid":"e5362aba-d9a9-40d6-b824-9a8c768de93f","title":"Create FeedbackMark Tiptap extension for text highlighting","content":"Create a custom Tiptap Mark extension to highlight text that has associated feedback.\n\n## Acceptance Criteria\n\n- [ ] Create `frontend/src/components/specs/extensions/FeedbackMark.ts`\n- [ ] Mark adds `data-feedback-id` attribute to highlighted text\n- [ ] Applies background color styling (bg-yellow-100)\n- [ ] Supports hover state (bg-yellow-200)\n- [ ] Cursor changes to pointer on hover\n- [ ] Properly parses HTML with feedback attributes\n- [ ] Export extension for use in TiptapEditor\n\n## Implementation Details\n\n```typescript\nimport { Mark } from '@tiptap/core'\n\nexport const FeedbackMark = Mark.create({\n  name: 'feedbackHighlight',\n  \n  addAttributes() {\n    return {\n      feedbackId: {\n        default: null,\n        parseHTML: element => element.getAttribute('data-feedback-id'),\n        renderHTML: attributes => ({\n          'data-feedback-id': attributes.feedbackId,\n        }),\n      },\n    }\n  },\n  \n  parseHTML() {\n    return [{ tag: 'mark[data-feedback-id]' }]\n  },\n  \n  renderHTML({ HTMLAttributes }) {\n    return [\n      'mark',\n      {\n        ...HTMLAttributes,\n        class: 'bg-yellow-100 cursor-pointer hover:bg-yellow-200 transition-colors'\n      },\n      0\n    ]\n  },\n})\n```\n\n## Testing\n\n- Test that mark renders with correct attributes\n- Test that styling is applied correctly\n- Test hover states\n\n## Reference\n\nImplementation details in [[SPEC-008]]","status":"closed","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 10:13:17","updated_at":"2025-10-29 10:42:30","closed_at":"2025-10-29 10:42:30","parent_id":null,"relationships":[{"from":"ISSUE-066","from_type":"issue","to":"SPEC-008","to_type":"spec","type":"implements"}],"tags":["frontend","phase-1","tiptap"]}
{"id":"ISSUE-067","uuid":"9f83646f-5693-453b-ac31-204316d850af","title":"Create useFeedbackPositions hook for position tracking","content":"Create a custom React hook to track the vertical positions of feedback anchors in the document.\n\n## Acceptance Criteria\n\n- [ ] Create `frontend/src/hooks/useFeedbackPositions.ts`\n- [ ] Hook accepts feedback array and editor ref as parameters\n- [ ] Returns Map<string, number> of feedback IDs to vertical positions\n- [ ] Updates positions on scroll with 100ms debounce\n- [ ] Updates positions on window resize\n- [ ] Updates positions when feedback changes\n- [ ] Properly cleans up event listeners on unmount\n- [ ] Handles missing elements gracefully\n\n## Implementation Details\n\n```typescript\nexport function useFeedbackPositions(\n  feedback: IssueFeedback[],\n  editorRef: RefObject<HTMLElement>\n): Map<string, number> {\n  const [positions, setPositions] = useState<Map<string, number>>(new Map())\n  \n  useEffect(() => {\n    const updatePositions = () => {\n      const newPositions = new Map<string, number>()\n      const editorRect = editorRef.current?.getBoundingClientRect()\n      \n      if (!editorRect) return\n      \n      feedback.forEach(fb => {\n        if (!fb.anchor?.line_number) return\n        \n        // Find element by feedback ID or line number\n        const element = editorRef.current?.querySelector(\n          `[data-feedback-id=\"${fb.id}\"]`\n        ) || editorRef.current?.querySelector(\n          `[data-line=\"${fb.anchor.line_number}\"]`\n        )\n        \n        if (element) {\n          const rect = element.getBoundingClientRect()\n          const scrollTop = editorRef.current?.scrollTop || 0\n          const top = rect.top - editorRect.top + scrollTop\n          newPositions.set(fb.id, top)\n        }\n      })\n      \n      setPositions(newPositions)\n    }\n    \n    // Debounce helper\n    const debouncedUpdate = debounce(updatePositions, 100)\n    \n    // Setup listeners\n    const editor = editorRef.current\n    editor?.addEventListener('scroll', debouncedUpdate)\n    window.addEventListener('resize', debouncedUpdate)\n    \n    // Initial update\n    updatePositions()\n    \n    return () => {\n      editor?.removeEventListener('scroll', debouncedUpdate)\n      window.removeEventListener('resize', debouncedUpdate)\n    }\n  }, [feedback, editorRef])\n  \n  return positions\n}\n```\n\n## Testing\n\n- Test position calculation accuracy\n- Test scroll event handling\n- Test resize event handling\n- Test cleanup on unmount\n- Test with no feedback\n- Test with feedback without anchors\n\n## Dependencies\n\n- [[ISSUE-066]] - FeedbackMark extension for data-feedback-id attributes\n\n## Reference\n\nImplementation details in [[SPEC-008]]","status":"closed","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 10:13:33","updated_at":"2025-10-29 10:42:19","closed_at":"2025-10-29 10:42:19","parent_id":null,"relationships":[{"from":"ISSUE-067","from_type":"issue","to":"SPEC-008","to_type":"spec","type":"implements"}],"tags":["frontend","phase-1","react-hooks"]}
{"id":"ISSUE-068","uuid":"0ee198e3-44f5-4b05-a79f-30a12de9f078","title":"Create AlignedFeedbackPanel component","content":"Create a new component to display feedback aligned with document positions using absolute positioning.\n\n## Acceptance Criteria\n\n- [ ] Create `frontend/src/components/specs/AlignedFeedbackPanel.tsx`\n- [ ] Component accepts feedback array and positions map\n- [ ] Separates general comments (no anchor) from anchored comments\n- [ ] General comments shown in sticky section at top\n- [ ] Anchored comments positioned absolutely based on positions map\n- [ ] Renders FeedbackCard for each comment\n- [ ] Supports onClick, onDismiss, onDelete callbacks\n- [ ] Properly handles missing positions (don't render)\n- [ ] Applies smooth transitions for position changes\n\n## Implementation Details\n\n```typescript\ninterface AlignedFeedbackPanelProps {\n  feedback: IssueFeedback[]\n  positions: Map<string, number>\n  onFeedbackClick?: (feedback: IssueFeedback) => void\n  onDismiss?: (id: string) => void\n  onDelete?: (id: string) => void\n  className?: string\n}\n\nexport function AlignedFeedbackPanel({\n  feedback,\n  positions,\n  onFeedbackClick,\n  onDismiss,\n  onDelete,\n  className = '',\n}: AlignedFeedbackPanelProps) {\n  // Separate general vs. anchored comments\n  const { generalComments, anchoredComments } = useMemo(() => {\n    const general: IssueFeedback[] = []\n    const anchored: IssueFeedback[] = []\n    \n    feedback.forEach(fb => {\n      if (fb.anchor?.line_number) {\n        anchored.push(fb)\n      } else {\n        general.push(fb)\n      }\n    })\n    \n    return { generalComments: general, anchoredComments: anchored }\n  }, [feedback])\n  \n  return (\n    <div className={`feedback-panel w-80 border-l bg-background ${className}`}>\n      {/* General comments section */}\n      {generalComments.length > 0 && (\n        <section className=\"border-b bg-muted/30 p-4\">\n          <h3 className=\"mb-2 text-sm font-semibold\">💭 General Comments</h3>\n          <div className=\"space-y-2\">\n            {generalComments.map(fb => (\n              <FeedbackCard\n                key={fb.id}\n                feedback={fb}\n                onClick={() => onFeedbackClick?.(fb)}\n                onDismiss={() => onDismiss?.(fb.id)}\n                onDelete={() => onDelete?.(fb.id)}\n              />\n            ))}\n          </div>\n        </section>\n      )}\n      \n      {/* Positioned comments */}\n      <div className=\"relative min-h-screen\">\n        {anchoredComments.map(fb => {\n          const top = positions.get(fb.id)\n          if (top === undefined) return null\n          \n          return (\n            <div\n              key={fb.id}\n              className=\"absolute w-full px-2 transition-all duration-200\"\n              style={{ top: `${top}px` }}\n            >\n              <FeedbackCard\n                feedback={fb}\n                onClick={() => onFeedbackClick?.(fb)}\n                onDismiss={() => onDismiss?.(fb.id)}\n                onDelete={() => onDelete?.(fb.id)}\n              />\n            </div>\n          )\n        })}\n      </div>\n    </div>\n  )\n}\n```\n\n## Testing\n\n- Test rendering with general comments only\n- Test rendering with anchored comments only\n- Test rendering with mixed comments\n- Test position updates trigger re-render\n- Test callbacks fire correctly\n- Test with empty feedback array\n\n## Dependencies\n\n- [[ISSUE-067]] - useFeedbackPositions hook for positions map\n- Existing FeedbackCard component\n\n## Reference\n\nImplementation details in [[SPEC-008]]","status":"closed","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 10:13:51","updated_at":"2025-10-29 10:41:18","closed_at":"2025-10-29 10:41:18","parent_id":null,"relationships":[{"from":"ISSUE-068","from_type":"issue","to":"ISSUE-067","to_type":"issue","type":"depends-on"},{"from":"ISSUE-068","from_type":"issue","to":"SPEC-008","to_type":"spec","type":"implements"}],"tags":["frontend","phase-1","react"]}
{"id":"ISSUE-069","uuid":"dfc5d090-b95e-4925-bd7e-d97a1d0fc917","title":"Integrate FeedbackMark extension into TiptapEditor","content":"Add the FeedbackMark extension to the TiptapEditor and wire it up with feedback data.\n\n## Acceptance Criteria\n\n- [ ] Import FeedbackMark extension in TiptapEditor\n- [ ] Add FeedbackMark to editor extensions array\n- [ ] Add feedback prop to TiptapEditor interface\n- [ ] Apply marks to content based on feedback anchors\n- [ ] Update editor content when feedback changes\n- [ ] Handle click events on marked text\n- [ ] Ensure marks persist through editor updates\n- [ ] Don't interfere with existing editing functionality\n\n## Implementation Details\n\n**Update TiptapEditor props:**\n```typescript\ninterface TiptapEditorProps {\n  content: string\n  editable?: boolean\n  onSave?: (markdown: string) => void\n  onChange?: (markdown: string) => void\n  onCancel?: () => void\n  className?: string\n  showToolbar?: boolean\n  feedback?: IssueFeedback[]  // NEW\n  onFeedbackClick?: (feedbackId: string) => void  // NEW\n}\n```\n\n**Add extension:**\n```typescript\nconst editor = useEditor({\n  extensions: [\n    StarterKit,\n    CodeBlockLowlight.configure({ lowlight }),\n    TabHandler,\n    // ... other extensions\n    FeedbackMark,  // NEW\n  ],\n  // ...\n})\n```\n\n**Apply marks on feedback change:**\n```typescript\nuseEffect(() => {\n  if (!editor || !feedback) return\n  \n  feedback.forEach(fb => {\n    if (fb.anchor?.line_number) {\n      // Find position and apply mark\n      // This might need helper function to find position by line\n    }\n  })\n}, [editor, feedback])\n```\n\n## Testing\n\n- Test marks appear when feedback is added\n- Test marks update when feedback changes\n- Test marks are removed when feedback is deleted\n- Test click events fire correctly\n- Test editor remains editable with marks present\n\n## Dependencies\n\n- [[ISSUE-066]] - FeedbackMark extension must be created first\n\n## Reference\n\nImplementation details in [[SPEC-008]]","status":"closed","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 10:14:07","updated_at":"2025-10-29 10:41:51","closed_at":"2025-10-29 10:41:51","parent_id":null,"relationships":[{"from":"ISSUE-069","from_type":"issue","to":"SPEC-008","to_type":"spec","type":"implements"}],"tags":["frontend","phase-1","tiptap"]}
{"id":"ISSUE-070","uuid":"60ebdcaf-1342-4c58-b576-eca49ac8961b","title":"Update SpecDetailPage to use AlignedFeedbackPanel with position tracking","content":"Integrate the new AlignedFeedbackPanel and position tracking system into SpecDetailPage, replacing the current sidebar layout.\n\n## Acceptance Criteria\n\n- [ ] Update layout to side-by-side (editor + aligned panel)\n- [ ] Create ref for editor container\n- [ ] Use useFeedbackPositions hook with feedback and editor ref\n- [ ] Pass feedback and positions to AlignedFeedbackPanel\n- [ ] Pass feedback to TiptapEditor for highlighting\n- [ ] Wire up all callback handlers (click, dismiss, delete)\n- [ ] Ensure existing feedback functionality still works\n- [ ] Test with view mode toggle (Formatted/Markdown)\n- [ ] Responsive behavior on mobile (consider stacking)\n- [ ] Remove or deprecate old SpecFeedbackPanel (if no longer needed)\n\n## Implementation Details\n\n**Update SpecDetailPage layout:**\n```typescript\nexport function SpecDetailPage() {\n  const { id } = useParams()\n  const editorRef = useRef<HTMLDivElement>(null)\n  \n  const { spec } = useSpec(id)\n  const { feedback } = useSpecFeedback(id)\n  \n  // Use position tracking hook\n  const positions = useFeedbackPositions(feedback, editorRef)\n  \n  return (\n    <div className=\"flex h-full\">\n      {/* Editor column */}\n      <div className=\"flex-1 overflow-auto\" ref={editorRef}>\n        <TiptapEditor\n          content={spec.content}\n          feedback={feedback}\n          onFeedbackClick={handleFeedbackClick}\n          // ... other props\n        />\n      </div>\n      \n      {/* Aligned feedback panel */}\n      <AlignedFeedbackPanel\n        feedback={feedback}\n        positions={positions}\n        onFeedbackClick={handleFeedbackClick}\n        onDismiss={handleDismiss}\n        onDelete={handleDelete}\n      />\n    </div>\n  )\n}\n```\n\n## Testing\n\n- Test layout renders correctly\n- Test positions update on scroll\n- Test clicking feedback focuses comment\n- Test dismissing/deleting feedback\n- Test with no feedback\n- Test with general comments only\n- Test with anchored comments only\n- Test view mode switching\n- Test mobile responsive behavior\n\n## Dependencies\n\n- [[ISSUE-066]] - FeedbackMark extension\n- [[ISSUE-067]] - useFeedbackPositions hook\n- [[ISSUE-068]] - AlignedFeedbackPanel component\n- [[ISSUE-069]] - TiptapEditor integration\n\n## Reference\n\nImplementation details in [[SPEC-008]]","status":"closed","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 10:14:23","updated_at":"2025-10-29 10:42:52","closed_at":"2025-10-29 10:42:52","parent_id":null,"relationships":[{"from":"ISSUE-070","from_type":"issue","to":"ISSUE-067","to_type":"issue","type":"depends-on"},{"from":"ISSUE-070","from_type":"issue","to":"ISSUE-068","to_type":"issue","type":"depends-on"},{"from":"ISSUE-070","from_type":"issue","to":"ISSUE-069","to_type":"issue","type":"depends-on"},{"from":"ISSUE-070","from_type":"issue","to":"SPEC-008","to_type":"spec","type":"implements"}],"tags":["frontend","integration","phase-1"]}
{"id":"ISSUE-071","uuid":"dd71ec35-4e80-4066-9eab-e63fb2adea5f","title":"Phase 1: Test and validate inline feedback visualization","content":"Comprehensive testing and validation of Phase 1 implementation to ensure all components work together correctly.\n\n## Acceptance Criteria\n\n- [ ] Manual testing with sample feedback data\n- [ ] Test all user interactions (click, hover, scroll)\n- [ ] Test position accuracy with different document lengths\n- [ ] Test performance with many comments (10+, 50+)\n- [ ] Verify no visual regressions in existing UI\n- [ ] Test on different screen sizes (desktop, tablet, mobile)\n- [ ] Test with both view modes (Formatted/Markdown)\n- [ ] Write/update unit tests for new components\n- [ ] Write integration tests for full flow\n- [ ] Document any known issues or limitations\n\n## Test Scenarios\n\n### Basic Functionality\n- [ ] General comments appear in top section\n- [ ] Anchored comments align with correct lines\n- [ ] Highlights appear on referenced text\n- [ ] Clicking highlight focuses comment\n- [ ] Scrolling updates comment positions smoothly\n\n### Edge Cases\n- [ ] Empty feedback list\n- [ ] Feedback without anchors only\n- [ ] Very long document (1000+ lines)\n- [ ] Many comments on same line\n- [ ] Comments on first and last lines\n- [ ] Rapid scrolling doesn't cause jank\n\n### Responsive Design\n- [ ] Desktop layout (side-by-side)\n- [ ] Tablet layout\n- [ ] Mobile layout (consider stacking)\n\n### Performance\n- [ ] No noticeable lag when scrolling\n- [ ] Position updates are debounced\n- [ ] Memory cleanup on unmount\n\n## Bugs to Watch For\n\n- Position drift after multiple scrolls\n- Overlapping comments in panel\n- Missing highlights for some feedback\n- Event listener leaks\n- Race conditions in position updates\n\n## Dependencies\n\n- [[ISSUE-066]] - FeedbackMark extension\n- [[ISSUE-067]] - useFeedbackPositions hook\n- [[ISSUE-068]] - AlignedFeedbackPanel component\n- [[ISSUE-069]] - TiptapEditor integration\n- [[ISSUE-070]] - SpecDetailPage integration\n\n## Reference\n\nImplementation details in [[SPEC-008]]","status":"closed","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-10-29 10:14:40","updated_at":"2025-10-29 10:41:34","closed_at":"2025-10-29 10:41:34","parent_id":null,"relationships":[{"from":"ISSUE-071","from_type":"issue","to":"SPEC-008","to_type":"spec","type":"implements"}],"tags":["frontend","phase-1","testing"]}
